# 端到端测试计划

## 测试目标
验证整个 AI DevOps 平台的完整用户流程，从用户注册到部署应用的全过程。

## 测试环境准备

### 1. 后端服务
```bash
# 启动数据库
docker-compose up -d postgres redis

# 启动后端服务
cd apps/api-gateway
bun install
bun run dev
```

### 2. 前端服务
```bash
# 启动前端
cd apps/web
bun install
bun run dev
```

### 3. 外部服务（可选）
- Ollama (AI 功能)
- Grafana (监控可视化)
- Jaeger (链路追踪)
- Prometheus (指标收集)

## 测试流程

### 阶段 1: 用户认证 ✅

#### 1.1 用户注册
- [ ] 访问 `/login`
- [ ] 点击"注册"按钮
- [ ] 填写注册表单
  - 邮箱
  - 用户名
  - 密码
- [ ] 提交注册
- [ ] 验证注册成功提示

#### 1.2 用户登录
- [ ] 访问 `/login`
- [ ] 填写登录表单
  - 邮箱/用户名
  - 密码
- [ ] 提交登录
- [ ] 验证跳转到首页
- [ ] 验证用户信息显示在右上角

#### 1.3 认证状态
- [ ] 验证 Token 存储在 localStorage
- [ ] 刷新页面，验证登录状态保持
- [ ] 验证路由守卫（未登录访问受保护页面会跳转到登录页）

### 阶段 2: 组织管理 ✅

#### 2.1 创建组织
- [ ] 访问 `/organizations`
- [ ] 点击"创建组织"按钮
- [ ] 填写组织信息
  - 组织名称
  - Slug
  - 描述
- [ ] 提交创建
- [ ] 验证组织出现在列表中
- [ ] 验证成功提示

#### 2.2 查看组织详情
- [ ] 点击组织卡片
- [ ] 验证跳转到组织详情页 `/organizations/:id`
- [ ] 验证显示组织信息
- [ ] 验证显示标签页（概览、成员、团队、设置）

#### 2.3 切换组织
- [ ] 在侧边栏点击组织切换器
- [ ] 选择另一个组织
- [ ] 验证当前组织切换成功
- [ ] 验证相关数据更新

### 阶段 3: 团队管理 ✅

#### 3.1 创建团队
- [ ] 访问 `/teams`
- [ ] 确保已选择组织
- [ ] 点击"创建团队"按钮
- [ ] 填写团队信息
  - 团队名称
  - 描述
- [ ] 提交创建
- [ ] 验证团队出现在列表中

#### 3.2 管理团队成员
- [ ] 点击团队卡片
- [ ] 添加成员到团队
- [ ] 验证成员列表更新
- [ ] 移除成员
- [ ] 验证成员被移除

### 阶段 4: 项目管理 ✅

#### 4.1 创建项目
- [ ] 访问 `/projects`
- [ ] 确保已选择组织
- [ ] 点击"创建项目"按钮
- [ ] 填写项目信息
  - 项目名称
  - Slug
  - 描述
  - 配置（默认分支、启用 CI/CD、启用 AI）
- [ ] 提交创建
- [ ] 验证项目出现在列表中

#### 4.2 查看项目详情
- [ ] 点击项目卡片
- [ ] 验证跳转到项目详情页 `/projects/:id`
- [ ] 验证显示项目信息
- [ ] 验证显示标签页（概览、仓库、环境、Pipeline、部署、成员、设置）

#### 4.3 搜索项目
- [ ] 在项目列表页输入搜索关键词
- [ ] 验证搜索结果正确
- [ ] 清空搜索
- [ ] 验证显示所有项目

### 阶段 5: 仓库管理 ✅

#### 5.1 连接仓库
- [ ] 在项目详情页切换到"仓库"标签
- [ ] 点击"连接仓库"按钮
- [ ] 填写仓库信息
  - 仓库 URL
  - 分支
  - 认证信息
- [ ] 提交连接
- [ ] 验证仓库出现在列表中

#### 5.2 同步仓库
- [ ] 点击"同步"按钮
- [ ] 验证同步状态更新
- [ ] 验证同步成功提示

### 阶段 6: 环境管理 ✅

#### 6.1 创建环境
- [ ] 访问 `/environments`
- [ ] 点击"创建环境"按钮
- [ ] 填写环境信息
  - 环境名称
  - 类型（development/staging/production）
  - 配置
- [ ] 提交创建
- [ ] 验证环境出现在列表中

#### 6.2 查看环境状态
- [ ] 验证环境卡片显示状态
- [ ] 验证环境配置信息
- [ ] 编辑环境
- [ ] 验证更新成功

### 阶段 7: Pipeline 管理 ✅

#### 7.1 创建 Pipeline
- [ ] 访问 `/pipelines`
- [ ] 点击"创建 Pipeline"按钮
- [ ] 填写 Pipeline 信息
  - Pipeline 名称
  - 项目
  - 配置（触发器、阶段）
- [ ] 提交创建
- [ ] 验证 Pipeline 出现在列表中

#### 7.2 触发 Pipeline
- [ ] 点击 Pipeline 的"运行"按钮
- [ ] 验证 Pipeline 开始运行
- [ ] 验证状态更新

#### 7.3 查看 Pipeline 日志
- [ ] 点击运行中的 Pipeline
- [ ] 验证显示实时日志
- [ ] 验证日志自动滚动
- [ ] 验证状态实时更新

### 阶段 8: 部署管理 ✅

#### 8.1 创建部署
- [ ] 访问 `/deployments`
- [ ] 触发一个部署（通过 Pipeline 或手动）
- [ ] 验证部署出现在列表中

#### 8.2 查看部署详情
- [ ] 点击部署记录
- [ ] 验证跳转到部署详情页 `/deployments/:id`
- [ ] 验证显示部署时间线
- [ ] 验证显示部署状态

#### 8.3 部署审批
- [ ] 如果部署需要审批
- [ ] 点击"审批"按钮
- [ ] 填写审批意见
- [ ] 提交审批
- [ ] 验证部署继续进行

#### 8.4 筛选部署
- [ ] 使用环境筛选器
- [ ] 验证筛选结果正确
- [ ] 切换不同环境
- [ ] 验证列表更新

### 阶段 9: 模板生成 ✅

#### 9.1 生成配置模板
- [ ] 访问 `/templates`
- [ ] 选择模板类型
- [ ] 填写模板参数
- [ ] 生成模板
- [ ] 验证模板预览

#### 9.2 使用模板
- [ ] 复制模板内容
- [ ] 或下载模板文件
- [ ] 验证内容正确

### 阶段 10: 监控和可观测性 ✅

#### 10.1 查看 Dashboard
- [ ] 访问 `/dashboard`
- [ ] 验证显示统计卡片
  - 项目数量
  - 部署数量
  - Pipeline 运行次数
  - 成本统计
- [ ] 验证数据正确

#### 10.2 查看可观测性
- [ ] 访问 `/observability`
- [ ] 切换 Metrics 标签
- [ ] 验证 Grafana 嵌入正常
- [ ] 切换 Traces 标签
- [ ] 验证 Jaeger 嵌入正常
- [ ] 切换 Logs 标签
- [ ] 验证日志查询正常

#### 10.3 查看告警
- [ ] 访问 `/monitoring/alerts`
- [ ] 验证显示 Prometheus 告警
- [ ] 静默告警
- [ ] 确认告警
- [ ] 验证操作成功

### 阶段 11: 通知系统 ✅

#### 11.1 查看通知
- [ ] 点击导航栏的通知图标
- [ ] 验证显示未读数量
- [ ] 访问 `/notifications`
- [ ] 验证显示通知列表

#### 11.2 管理通知
- [ ] 标记通知为已读
- [ ] 验证未读数量更新
- [ ] 删除通知
- [ ] 验证通知被移除

### 阶段 12: 安全管理 ✅

#### 12.1 配置安全策略
- [ ] 访问 `/security/policies`
- [ ] 创建安全策略
- [ ] 填写策略规则（JSONB）
- [ ] 提交创建
- [ ] 验证策略生效

#### 12.2 查看审计日志
- [ ] 访问 `/security/audit-logs`
- [ ] 验证显示操作日志
- [ ] 使用筛选器
- [ ] 导出日志
- [ ] 验证导出成功

### 阶段 13: 成本追踪 ✅

#### 13.1 查看成本
- [ ] 访问 `/cost/tracking`
- [ ] 验证显示成本图表
- [ ] 验证显示成本分类
- [ ] 验证显示预算告警

### 阶段 14: AI 助手 ✅

#### 14.1 使用 AI 助手
- [ ] 访问 `/ai/assistants`
- [ ] 输入问题
- [ ] 发送消息
- [ ] 验证 AI 回复（流式）
- [ ] 对回复评分
- [ ] 验证评分成功

### 阶段 15: 用户设置 ✅

#### 15.1 配置主题
- [ ] 访问 `/settings`
- [ ] 切换到"外观"标签
- [ ] 选择浅色主题
- [ ] 验证主题切换
- [ ] 选择深色主题
- [ ] 验证主题切换
- [ ] 选择跟随系统
- [ ] 验证主题跟随系统

#### 15.2 配置通知偏好
- [ ] 切换到"通知"标签
- [ ] 启用/禁用通知
- [ ] 启用/禁用声音
- [ ] 验证设置保存

#### 15.3 配置显示偏好
- [ ] 切换到"显示"标签
- [ ] 启用/禁用紧凑模式
- [ ] 启用/禁用动画
- [ ] 验证设置保存

#### 15.4 退出登录
- [ ] 点击用户菜单
- [ ] 点击"退出登录"
- [ ] 验证跳转到登录页
- [ ] 验证登录状态清除

## 错误场景测试

### 1. 网络错误
- [ ] 断开网络
- [ ] 尝试加载数据
- [ ] 验证显示 ErrorState
- [ ] 点击重试
- [ ] 恢复网络
- [ ] 验证数据加载成功

### 2. API 错误
- [ ] 触发 API 错误（如无效输入）
- [ ] 验证显示错误提示
- [ ] 验证 Toast 通知
- [ ] 验证表单验证错误

### 3. 权限错误
- [ ] 尝试访问无权限的资源
- [ ] 验证显示权限错误
- [ ] 验证跳转到合适的页面

## 性能测试

### 1. 加载性能
- [ ] 测试首页加载时间
- [ ] 测试路由切换速度
- [ ] 测试大列表渲染性能

### 2. 动画性能
- [ ] 验证页面过渡动画流畅
- [ ] 验证卡片动画流畅
- [ ] 验证列表动画流畅

### 3. 实时更新
- [ ] 验证 Pipeline 日志实时更新
- [ ] 验证通知实时更新
- [ ] 验证状态实时更新

## 浏览器兼容性

- [ ] Chrome (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (最新版本)
- [ ] Edge (最新版本)

## 响应式测试

- [ ] 桌面端 (1920x1080)
- [ ] 笔记本 (1366x768)
- [ ] 平板 (768x1024)
- [ ] 手机 (375x667)

## 测试报告模板

```markdown
## 测试执行报告

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**测试环境**: [开发/测试/生产]

### 测试结果总结
- 总测试用例数: X
- 通过: X
- 失败: X
- 跳过: X

### 失败用例详情
1. [用例名称]
   - 预期结果: [描述]
   - 实际结果: [描述]
   - 错误信息: [描述]
   - 截图: [链接]

### 性能指标
- 首页加载时间: Xs
- 平均路由切换时间: Xs
- API 平均响应时间: Xms

### 建议和改进
- [建议 1]
- [建议 2]
```

## 自动化测试建议

### 使用 Playwright 或 Cypress
```typescript
// 示例：登录测试
test('用户登录流程', async ({ page }) => {
  await page.goto('/login')
  await page.fill('[name="email"]', 'test@example.com')
  await page.fill('[name="password"]', 'password123')
  await page.click('button[type="submit"]')
  await expect(page).toHaveURL('/')
  await expect(page.locator('.user-menu')).toBeVisible()
})
```

## 下一步

1. **手动测试**: 按照此计划进行完整的手动测试
2. **记录问题**: 发现的问题记录到 GitHub Issues
3. **修复问题**: 优先修复关键问题
4. **自动化**: 将关键流程转换为自动化测试
5. **持续集成**: 将测试集成到 CI/CD 流程

## 测试优先级

### P0 - 关键功能（必须通过）
- 用户认证
- 组织管理
- 项目管理
- Pipeline 运行
- 部署流程

### P1 - 重要功能（应该通过）
- 团队管理
- 环境管理
- 通知系统
- 监控告警

### P2 - 次要功能（可以延后）
- AI 助手
- 成本追踪
- 模板生成
- 审计日志

## 准备开始测试

现在可以开始执行端到端测试了！建议按照以下顺序：

1. 启动后端服务
2. 启动前端服务
3. 按照测试流程逐步执行
4. 记录测试结果
5. 修复发现的问题
6. 重新测试

祝测试顺利！🚀

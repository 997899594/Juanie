# 项目创建指南

## 概述

本指南将帮助您使用项目创建向导快速创建生产级的应用项目。系统会自动完成环境配置、Git 仓库设置、K8s 资源创建等所有初始化工作。

---

## 前提条件

在创建项目之前，请确保：

1. ✅ 您已加入一个组织
2. ✅ 您有项目创建权限（组织成员或管理员）
3. ✅ 如果要关联 Git 仓库，准备好访问令牌：
   - GitHub: [创建 Personal Access Token](https://github.com/settings/tokens)
   - GitLab: [创建 Personal Access Token](https://gitlab.com/-/profile/personal_access_tokens)

---

## 创建项目的步骤

### 步骤 1: 进入项目创建向导

1. 登录系统后，点击左侧导航栏的 **"项目"**
2. 点击右上角的 **"创建项目"** 按钮
3. 系统会打开多步骤的项目创建向导

### 步骤 2: 填写基本信息

在第一步中，填写项目的基本信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| **项目名称** | 项目的显示名称 | `My React App` |
| **项目标识** | URL 友好的唯一标识（自动生成） | `my-react-app` |
| **描述** | 项目的简短描述（可选） | `一个生产级的 React 应用` |
| **可见性** | 项目的访问权限 | `private` / `internal` / `public` |

**提示：**
- 项目标识会自动根据项目名称生成，也可以手动修改
- 项目标识创建后不可修改，请谨慎填写
- 私有项目只有组织成员可见

点击 **"下一步"** 继续。

---

### 步骤 3: 选择项目模板

系统提供多种生产级项目模板，每个模板都包含最佳实践配置。

#### 可用模板

| 模板 | 适用场景 | 技术栈 | 资源配置 |
|------|---------|--------|---------|
| **⚛️ React 应用** | 单页应用（SPA） | React + Nginx | 轻量级 |
| **🟢 Node.js API** | RESTful API 服务 | Node.js + Express | 中等 |
| **🔵 Go 微服务** | 高性能微服务 | Go | 最小化 |
| **🐍 Python API** | 数据处理 API | Python + FastAPI | 中等 |
| **📄 静态网站** | 文档、博客等 | HTML + Nginx | 最小化 |

#### 如何选择模板

1. **浏览模板卡片**：每个模板显示图标、名称、描述和技术栈
2. **查看详情**：点击模板卡片查看详细配置（环境变量、资源限制、健康检查等）
3. **选择模板**：点击 **"使用此模板"** 按钮

**示例：选择 React 应用模板**

```
模板名称: React Application
技术栈: React 18 + Nginx
默认配置:
  - 开发环境: 1 副本, 100m CPU, 128Mi 内存
  - 测试环境: 2 副本, 200m CPU, 256Mi 内存
  - 生产环境: 3 副本, 500m CPU, 512Mi 内存
健康检查: HTTP GET / (每 10 秒)
```

点击 **"下一步"** 继续。

---

### 步骤 4: 配置 Git 仓库

您可以选择关联现有仓库或创建新仓库。

#### 选项 A: 关联现有仓库

如果您已有 Git 仓库，可以直接关联：

1. 选择 **"关联现有仓库"**
2. 填写仓库信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| **Git 提供商** | 选择 GitHub 或 GitLab | `GitHub` |
| **仓库 URL** | 完整的仓库地址 | `https://github.com/myorg/my-app` |
| **访问令牌** | 用于访问仓库的 Token | `ghp_xxxxxxxxxxxxx` |
| **默认分支** | 主分支名称（可选） | `main` |

3. 点击 **"验证连接"** 测试仓库访问权限
4. 验证成功后，点击 **"下一步"**

**注意：**
- 访问令牌需要 `repo` 权限（读写仓库）
- 系统会在仓库中创建 `k8s/` 目录存放 Kubernetes 配置
- 如果仓库已有 K8s 配置，系统会提示是否覆盖

#### 选项 B: 创建新仓库

如果您想创建全新的仓库：

1. 选择 **"创建新仓库"**
2. 填写仓库信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| **Git 提供商** | 选择 GitHub 或 GitLab | `GitHub` |
| **仓库名称** | 新仓库的名称 | `my-react-app` |
| **可见性** | 仓库的访问权限 | `private` / `public` |
| **访问令牌** | 用于创建仓库的 Token | `ghp_xxxxxxxxxxxxx` |
| **包含应用代码** | 是否生成应用代码模板 | ✅ 是 / ❌ 否 |

3. 点击 **"下一步"**

**提示：**
- 访问令牌需要 `repo` 和 `admin:repo_hook` 权限
- 如果选择"包含应用代码"，系统会根据模板生成初始代码
- 仓库会自动初始化 README、.gitignore 等文件

---

### 步骤 5: 配置环境

系统会根据模板自动创建三个环境，您可以自定义每个环境的配置。

#### 默认环境

| 环境 | 用途 | Git 分支 | 自动同步 |
|------|------|---------|---------|
| **Development** | 开发测试 | `develop` | ✅ 是 |
| **Staging** | 预发布测试 | `staging` | ✅ 是 |
| **Production** | 生产环境 | `main` | ❌ 否（需审批） |

#### 自定义配置

对于每个环境，您可以调整：

**1. 副本数**
```
开发环境: 1 副本（节省资源）
测试环境: 2 副本（模拟生产）
生产环境: 3 副本（高可用）
```

**2. 资源限制**
```yaml
resources:
  requests:
    cpu: "100m"      # 最小 CPU
    memory: "128Mi"  # 最小内存
  limits:
    cpu: "500m"      # 最大 CPU
    memory: "512Mi"  # 最大内存
```

**3. 环境变量**
```
NODE_ENV=production
API_URL=https://api.example.com
DATABASE_URL=postgresql://...
```

**4. GitOps 配置**
```
自动同步: 是/否
同步间隔: 5 分钟
Git 分支: main
Git 路径: k8s/overlays/production
```

**提示：**
- 生产环境建议关闭自动同步，启用审批流程
- 敏感信息（如数据库密码）应使用 Secret 管理
- 资源限制应根据实际负载调整

点击 **"下一步"** 继续。

---

### 步骤 6: 确认并创建

最后一步会显示所有配置的摘要：

```
项目信息:
  名称: My React App
  标识: my-react-app
  模板: React Application

仓库配置:
  提供商: GitHub
  仓库: https://github.com/myorg/my-react-app
  模式: 创建新仓库

环境配置:
  ✅ Development (1 副本, 自动同步)
  ✅ Staging (2 副本, 自动同步)
  ✅ Production (3 副本, 需审批)
```

确认无误后，点击 **"创建项目"** 按钮。

---

## 初始化过程

创建项目后，系统会自动执行以下初始化步骤：

### 初始化流程（约 2-3 分钟）

```
1. ✅ 创建项目记录
2. ✅ 验证模板配置
3. 🔄 创建环境（Development, Staging, Production）
4. 🔄 创建/关联 Git 仓库
5. 🔄 生成 Kubernetes 配置文件
6. 🔄 提交配置到 Git 仓库
7. 🔄 创建 GitOps 资源（Kustomization）
8. 🔄 等待 Flux 同步
9. 🔄 验证资源创建
10. ✅ 初始化完成
```

### 实时进度显示

在初始化过程中，您会看到：

- **进度条**：显示当前完成百分比（0-100%）
- **当前步骤**：显示正在执行的步骤名称
- **已完成步骤**：显示已完成的步骤列表
- **日志输出**：显示详细的执行日志

**示例进度显示：**

```
初始化进度: 60%

当前步骤: 生成 Kubernetes 配置文件

已完成:
✅ 创建项目记录
✅ 验证模板配置
✅ 创建环境
✅ 创建 Git 仓库
✅ 生成 Kubernetes 配置文件

进行中:
🔄 提交配置到 Git 仓库

待执行:
⏳ 创建 GitOps 资源
⏳ 等待 Flux 同步
⏳ 验证资源创建
```

---

## 初始化完成后

### 成功场景

初始化成功后，您会看到：

```
🎉 项目创建成功！

项目 "My React App" 已成功创建并初始化。

创建的资源:
  ✅ 3 个环境 (Development, Staging, Production)
  ✅ 1 个 Git 仓库 (my-react-app)
  ✅ 3 个 GitOps 资源 (Kustomization)
  ✅ 9 个 Kubernetes 资源 (Deployment, Service, Ingress)

下一步:
  1. 查看项目详情
  2. 配置 CI/CD Pipeline
  3. 部署第一个版本
```

点击 **"查看项目"** 跳转到项目详情页面。

### 失败场景

如果初始化失败，您会看到：

```
❌ 项目初始化失败

错误信息: Git 仓库创建失败: 访问令牌权限不足

已完成的步骤:
✅ 创建项目记录
✅ 验证模板配置
✅ 创建环境

失败的步骤:
❌ 创建 Git 仓库

建议操作:
  1. 检查 Git 访问令牌是否有 repo 权限
  2. 确认令牌未过期
  3. 重新配置 Git 仓库

操作:
  [重新配置] [查看日志] [联系支持]
```

**常见失败原因和解决方法：**

| 失败原因 | 解决方法 |
|---------|---------|
| Git 访问令牌无效 | 重新生成令牌并确保有正确权限 |
| 仓库名称已存在 | 使用不同的仓库名称 |
| 项目标识冲突 | 使用不同的项目标识 |
| Kubernetes 集群不可用 | 联系管理员检查集群状态 |
| 资源配额不足 | 联系管理员增加配额或删除不用的项目 |

---

## 查看项目详情

初始化完成后，在项目详情页面您可以：

### 1. 概览 Tab

- 查看项目基本信息
- 查看健康度评分和状态
- 查看最近的部署记录
- 查看资源使用情况

### 2. 环境 Tab

- 查看所有环境列表
- 查看每个环境的配置
- 管理环境变量
- 调整资源限制

### 3. 部署 Tab

- 查看部署历史
- 发起新的部署
- 回滚到历史版本
- 查看部署日志

### 4. 资源拓扑 Tab

- 查看项目的完整资源关系图
- 查看环境 → GitOps 资源 → K8s 资源的层级
- 点击资源查看详情

### 5. 健康度 Tab

- 查看健康度评分和趋势
- 查看各项健康指标
- 查看问题列表和建议
- 查看健康度历史图表

### 6. 设置 Tab

- 修改项目配置
- 管理项目成员
- 配置审批规则
- 归档或删除项目

---

## 下一步

项目创建完成后，您可以：

1. **配置 CI/CD Pipeline**
   - 参考 [CI/CD 配置指南](./CICD_SETUP_GUIDE.md)
   - 系统已自动生成 GitHub Actions / GitLab CI 配置

2. **部署第一个版本**
   - 参考 [部署指南](./DEPLOYMENT_GUIDE.md)
   - 推送代码到 Git 仓库会自动触发部署

3. **配置域名和 Ingress**
   - 参考 [域名配置指南](./DOMAIN_SETUP_GUIDE.md)
   - 为生产环境配置自定义域名

4. **设置监控和告警**
   - 参考 [监控配置指南](./MONITORING_GUIDE.md)
   - 配置 Prometheus 和 Grafana 监控

5. **邀请团队成员**
   - 在项目设置中添加成员
   - 配置成员的角色和权限

---

## 常见问题

### Q1: 项目标识可以修改吗？

**A:** 项目标识创建后不可修改，因为它用于生成 Git 仓库名称、K8s 资源名称等。如果需要修改，请创建新项目。

### Q2: 可以不使用模板创建项目吗？

**A:** 目前必须选择一个模板。如果现有模板不满足需求，可以：
1. 选择最接近的模板
2. 创建后手动修改配置
3. 或联系管理员创建自定义模板

### Q3: 初始化失败后如何重试？

**A:** 在项目详情页面，点击 **"重新初始化"** 按钮。系统会从失败的步骤继续执行。

### Q4: 可以跳过 Git 仓库配置吗？

**A:** 不可以。Git 仓库是 GitOps 流程的核心，必须配置。如果暂时没有仓库，可以选择"创建新仓库"。

### Q5: 如何删除创建失败的项目？

**A:** 在项目列表中，找到失败的项目，点击 **"删除"** 按钮。系统会清理所有已创建的资源。

### Q6: 生产环境为什么不能自动同步？

**A:** 为了安全性，生产环境默认需要审批才能部署。您可以在环境设置中修改此配置，但不推荐。

---

## 获取帮助

如果遇到问题，您可以：

1. **查看文档**
   - [故障排查指南](./TROUBLESHOOTING_GUIDE.md)
   - [API 参考文档](../api/projects/PROJECT_API.md)

2. **查看日志**
   - 在项目详情页面点击 **"查看日志"**
   - 查看详细的初始化日志和错误信息

3. **联系支持**
   - 发送邮件到 support@example.com
   - 在 Slack 频道 #devops-support 提问
   - 提交 GitHub Issue

---

## 相关文档

- [模板使用指南](./TEMPLATE_GUIDE.md)
- [审批流程说明](./APPROVAL_GUIDE.md)
- [健康度监控说明](./HEALTH_MONITORING_GUIDE.md)
- [故障排查指南](./TROUBLESHOOTING_GUIDE.md)

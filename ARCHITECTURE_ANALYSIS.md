# ä»“åº“æ¶æ„åˆ†æä¸æ”¹è¿›å»ºè®®

## ğŸ“Š å½“å‰æ¶æ„æ¦‚è§ˆ

### Monorepo ç»“æ„
```
Juanie/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/          # åç«¯ API (Bun + NestJS + tRPC)
â”‚   â””â”€â”€ web/          # å‰ç«¯ Web (Vue 3 + Vite)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/       # å…±äº«ä»£ç 
â”‚   â””â”€â”€ ui/           # UI ç»„ä»¶åº“
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ tsconfig/     # TypeScript é…ç½®
â”œâ”€â”€ gitlab/           # GitLab ç§æœ‰éƒ¨ç½²é…ç½®
â””â”€â”€ scripts/          # æ„å»ºè„šæœ¬
```

### æŠ€æœ¯æ ˆ
- **Monorepo å·¥å…·**: Turborepo + Bun Workspaces
- **åŒ…ç®¡ç†å™¨**: Bun 1.2.23
- **åç«¯**: Bun + NestJS 11 + tRPC 11
- **å‰ç«¯**: Vue 3 + Vite + Pinia
- **æ•°æ®åº“**: PostgreSQL 17 + Drizzle ORM
- **ç¼“å­˜**: Dragonfly (Redis å…¼å®¹)
- **CI/CD**: GitHub Actions + GitLab CI

---

## âœ… æ¶æ„ä¼˜ç‚¹

### 1. Monorepo è®¾è®¡è‰¯å¥½
- âœ… ä½¿ç”¨ Turborepo è¿›è¡Œä»»åŠ¡ç¼–æ’
- âœ… Bun Workspaces ç®¡ç†ä¾èµ–
- âœ… æ¸…æ™°çš„ apps/ å’Œ packages/ åˆ†ç¦»
- âœ… å…±äº« TypeScript é…ç½®

### 2. ç°ä»£åŒ–æŠ€æœ¯æ ˆ
- âœ… Bun è¿è¡Œæ—¶ï¼ˆé«˜æ€§èƒ½ï¼‰
- âœ… tRPC ç±»å‹å®‰å…¨ API
- âœ… Drizzle ORMï¼ˆç±»å‹å®‰å…¨ï¼‰
- âœ… Vue 3 Composition API

### 3. å®Œæ•´çš„ DevOps å·¥å…·é“¾
- âœ… Docker Compose æœ¬åœ°å¼€å‘
- âœ… CI/CD é…ç½®å®Œæ•´
- âœ… ç›‘æ§å’Œå¯è§‚æµ‹æ€§ï¼ˆGrafana + Prometheus + Lokiï¼‰

---

## âš ï¸ æ¶æ„é—®é¢˜ä¸æ”¹è¿›å»ºè®®

### 1. ğŸ”´ åç«¯ Monorepo æ¶æ„ç¼ºå¤±

**é—®é¢˜**:
å½“å‰ `apps/api/` æ˜¯ä¸€ä¸ªå•ä½“åº”ç”¨ï¼Œæ‰€æœ‰æ¨¡å—éƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼š
```
apps/api/src/modules/
â”œâ”€â”€ auth/
â”œâ”€â”€ organizations/
â”œâ”€â”€ teams/
â”œâ”€â”€ projects/
â”œâ”€â”€ pipelines/
â”œâ”€â”€ deployments/
â”œâ”€â”€ ai-assistants/
â”œâ”€â”€ storage/
â”œâ”€â”€ k3s/
â””â”€â”€ ... (20+ æ¨¡å—)
```

**å½±å“**:
- âŒ æ¨¡å—è€¦åˆåº¦é«˜ï¼Œéš¾ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- âŒ æ— æ³•ç‹¬ç«‹éƒ¨ç½²æŸä¸ªæœåŠ¡
- âŒ æ„å»ºæ—¶é—´éšæ¨¡å—å¢åŠ è€Œçº¿æ€§å¢é•¿
- âŒ å›¢é˜Ÿåä½œå®¹æ˜“äº§ç”Ÿå†²çª
- âŒ æ— æ³•é’ˆå¯¹ä¸åŒæœåŠ¡ä¼˜åŒ–èµ„æº

**æ”¹è¿›æ–¹æ¡ˆ A: æ¨¡å—åŒ– Monorepoï¼ˆæ¨èï¼‰**

å°†åç«¯æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„åŒ…ï¼Œä½†ä¿æŒåœ¨åŒä¸€ä¸ªä»“åº“ï¼š

```
apps/
â”œâ”€â”€ api-gateway/          # API ç½‘å…³ï¼ˆtRPC è·¯ç”±èšåˆï¼‰
â””â”€â”€ web/

packages/
â”œâ”€â”€ core/                 # æ ¸å¿ƒå…±äº«ä»£ç 
â”‚   â”œâ”€â”€ database/        # æ•°æ®åº“ schemas
â”‚   â”œâ”€â”€ types/           # å…±äº«ç±»å‹
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ services/            # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ auth/           # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ organizations/  # ç»„ç»‡æœåŠ¡
â”‚   â”œâ”€â”€ projects/       # é¡¹ç›®æœåŠ¡
â”‚   â”œâ”€â”€ pipelines/      # Pipeline æœåŠ¡
â”‚   â”œâ”€â”€ deployments/    # éƒ¨ç½²æœåŠ¡
â”‚   â””â”€â”€ ai/             # AI æœåŠ¡
â”œâ”€â”€ shared/
â””â”€â”€ ui/
```

**ä¼˜ç‚¹**:
- âœ… æ¨¡å—ç‹¬ç«‹ï¼Œå¯ä»¥å•ç‹¬æµ‹è¯•å’Œæ„å»º
- âœ… æ¸…æ™°çš„ä¾èµ–å…³ç³»
- âœ… æ›´å¥½çš„ä»£ç å¤ç”¨
- âœ… å¯ä»¥é€æ­¥è¿ç§»åˆ°å¾®æœåŠ¡
- âœ… Turborepo å¯ä»¥å¹¶è¡Œæ„å»ºå’Œæµ‹è¯•

**æ”¹è¿›æ–¹æ¡ˆ B: å¾®æœåŠ¡æ¶æ„ï¼ˆé•¿æœŸï¼‰**

å®Œå…¨æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å¾®æœåŠ¡ï¼š

```
apps/
â”œâ”€â”€ api-gateway/         # API ç½‘å…³
â”œâ”€â”€ auth-service/        # è®¤è¯æœåŠ¡
â”œâ”€â”€ org-service/         # ç»„ç»‡æœåŠ¡
â”œâ”€â”€ project-service/     # é¡¹ç›®æœåŠ¡
â”œâ”€â”€ pipeline-service/    # Pipeline æœåŠ¡
â”œâ”€â”€ deployment-service/  # éƒ¨ç½²æœåŠ¡
â”œâ”€â”€ ai-service/          # AI æœåŠ¡
â””â”€â”€ web/
```

**ä¼˜ç‚¹**:
- âœ… å®Œå…¨ç‹¬ç«‹éƒ¨ç½²
- âœ… æŠ€æœ¯æ ˆå¯ä»¥ä¸åŒ
- âœ… æ°´å¹³æ‰©å±•æ›´å®¹æ˜“
- âœ… æ•…éšœéš”ç¦»

**ç¼ºç‚¹**:
- âŒ å¤æ‚åº¦å¤§å¹…å¢åŠ 
- âŒ éœ€è¦æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡
- âŒ åˆ†å¸ƒå¼äº‹åŠ¡å¤æ‚
- âŒ è°ƒè¯•å›°éš¾

**å»ºè®®**: å…ˆé‡‡ç”¨æ–¹æ¡ˆ Aï¼ˆæ¨¡å—åŒ– Monorepoï¼‰ï¼Œä¸šåŠ¡å¢é•¿åå†è€ƒè™‘æ–¹æ¡ˆ B

---

### 2. ğŸŸ¡ packages/ ç›®å½•åˆ©ç”¨ä¸è¶³

**é—®é¢˜**:
- `packages/shared/` å’Œ `packages/ui/` å†…å®¹ä¸æ˜ç¡®
- æ²¡æœ‰å……åˆ†åˆ©ç”¨ monorepo çš„ä»£ç å…±äº«èƒ½åŠ›
- åç«¯å’Œå‰ç«¯çš„å…±äº«ä»£ç æ··åœ¨ä¸€èµ·

**æ”¹è¿›å»ºè®®**:

```
packages/
â”œâ”€â”€ core/                # æ ¸å¿ƒå…±äº«ä»£ç 
â”‚   â”œâ”€â”€ database/       # Drizzle schemas
â”‚   â”œâ”€â”€ types/          # å…±äº« TypeScript ç±»å‹
â”‚   â”œâ”€â”€ constants/      # å¸¸é‡
â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ api-client/         # tRPC å®¢æˆ·ç«¯ï¼ˆä¾›å‰ç«¯ä½¿ç”¨ï¼‰
â”œâ”€â”€ config/             # å…±äº«é…ç½®
â”‚   â”œâ”€â”€ eslint/
â”‚   â”œâ”€â”€ typescript/
â”‚   â””â”€â”€ vitest/
â”œâ”€â”€ ui/                 # UI ç»„ä»¶åº“
â””â”€â”€ shared/             # å…¶ä»–å…±äº«ä»£ç 
```

---

### 3. ğŸŸ¡ é…ç½®æ–‡ä»¶åˆ†æ•£

**é—®é¢˜**:
- TypeScript é…ç½®åœ¨ `configs/tsconfig/`
- Biome é…ç½®åœ¨æ ¹ç›®å½•
- å…¶ä»–é…ç½®åˆ†æ•£åœ¨å„ä¸ªé¡¹ç›®

**æ”¹è¿›å»ºè®®**:

```
configs/
â”œâ”€â”€ typescript/         # TS é…ç½®
â”œâ”€â”€ biome/             # Biome é…ç½®
â”œâ”€â”€ vitest/            # æµ‹è¯•é…ç½®
â”œâ”€â”€ docker/            # Docker é…ç½®
â””â”€â”€ ci/                # CI/CD é…ç½®æ¨¡æ¿
```

---

### 4. ğŸŸ¡ GitLab ç§æœ‰éƒ¨ç½²é…ç½®æ··åœ¨ä¸»ä»“åº“

**é—®é¢˜**:
- `gitlab/` ç›®å½•åŒ…å«å®Œæ•´çš„ GitLab éƒ¨ç½²é…ç½®
- ä¸ä¸»é¡¹ç›®ä»£ç æ··åœ¨ä¸€èµ·
- å¯èƒ½åŒ…å«æ•æ„Ÿé…ç½®

**æ”¹è¿›å»ºè®®**:

**é€‰é¡¹ A**: ç§»åˆ°ç‹¬ç«‹ä»“åº“
```bash
# åˆ›å»ºæ–°ä»“åº“
gitlab-deployment/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ config/
â””â”€â”€ scripts/
```

**é€‰é¡¹ B**: ä¿ç•™ä½†éš”ç¦»
```
infrastructure/
â”œâ”€â”€ gitlab/
â”œâ”€â”€ k8s/
â””â”€â”€ terraform/
```

---

### 5. ğŸŸ¡ ç¼ºå°‘æ˜ç¡®çš„ API ç‰ˆæœ¬ç®¡ç†

**é—®é¢˜**:
- tRPC è·¯ç”±æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶
- API å˜æ›´å¯èƒ½ç ´åå‰ç«¯

**æ”¹è¿›å»ºè®®**:

```typescript
// apps/api-gateway/src/trpc/router.ts
export const appRouter = router({
  v1: {
    auth: authRouter,
    organizations: organizationsRouter,
    // ...
  },
  v2: {
    // æ–°ç‰ˆæœ¬ API
  },
});
```

---

### 6. ğŸŸ¢ Docker Compose é…ç½®åˆç†ä½†å¯ä¼˜åŒ–

**å½“å‰**:
- æ‰€æœ‰æœåŠ¡åœ¨ä¸€ä¸ª `docker-compose.yml`
- é€‚åˆæœ¬åœ°å¼€å‘

**æ”¹è¿›å»ºè®®**:

```
docker/
â”œâ”€â”€ docker-compose.yml          # åŸºç¡€æœåŠ¡
â”œâ”€â”€ docker-compose.dev.yml      # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ docker-compose.prod.yml     # ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ docker-compose.test.yml     # æµ‹è¯•ç¯å¢ƒ
```

---

### 7. ğŸŸ¡ æµ‹è¯•ç­–ç•¥ä¸å¤Ÿæ¸…æ™°

**é—®é¢˜**:
- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ··åœ¨ä¸€èµ·
- æ²¡æœ‰ E2E æµ‹è¯•é…ç½®

**æ”¹è¿›å»ºè®®**:

```
apps/api/
â”œâ”€â”€ src/
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ unit/          # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/   # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/           # E2E æµ‹è¯•
â””â”€â”€ vitest.config.ts
```

---

## ğŸ¯ ä¼˜å…ˆçº§æ”¹è¿›è®¡åˆ’

### Phase 1: ç«‹å³æ”¹è¿›ï¼ˆ1-2 å‘¨ï¼‰

1. **æ•´ç† packages/ ç»“æ„**
   ```bash
   packages/
   â”œâ”€â”€ core/
   â”‚   â”œâ”€â”€ database/
   â”‚   â”œâ”€â”€ types/
   â”‚   â””â”€â”€ utils/
   â””â”€â”€ api-client/
   ```

2. **ç»Ÿä¸€é…ç½®ç®¡ç†**
   - å°†æ‰€æœ‰é…ç½®ç§»åˆ° `configs/`
   - åˆ›å»ºå…±äº«çš„ ESLintã€TypeScript é…ç½®

3. **æ”¹è¿›æ–‡æ¡£ç»“æ„**ï¼ˆå·²å®Œæˆ âœ…ï¼‰
   - æ–‡æ¡£å·²æ•´ç†åˆ° `apps/api/docs/`

### Phase 2: çŸ­æœŸæ”¹è¿›ï¼ˆ1-2 æœˆï¼‰

1. **æ¨¡å—åŒ–åç«¯æ¶æ„**
   - å°† `apps/api/src/modules/` æ‹†åˆ†åˆ° `packages/services/`
   - åˆ›å»º `apps/api-gateway/` ä½œä¸ºèšåˆå±‚
   - ä¿æŒ tRPC ç±»å‹å®‰å…¨

2. **å®Œå–„æµ‹è¯•ä½“ç³»**
   - åˆ†ç¦»å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
   - æ·»åŠ  E2E æµ‹è¯•
   - æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ° 80%+

3. **ä¼˜åŒ– CI/CD**
   - åˆ©ç”¨ Turborepo ç¼“å­˜
   - åªæ„å»ºå˜æ›´çš„åŒ…
   - å¹¶è¡Œè¿è¡Œæµ‹è¯•

### Phase 3: é•¿æœŸæ”¹è¿›ï¼ˆ3-6 æœˆï¼‰

1. **è€ƒè™‘å¾®æœåŠ¡æ¶æ„**
   - è¯„ä¼°ä¸šåŠ¡å¢é•¿æƒ…å†µ
   - è¯†åˆ«å¯ä»¥ç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡
   - é€æ­¥è¿ç§»

2. **å®Œå–„ç›‘æ§å’Œå¯è§‚æµ‹æ€§**
   - æœåŠ¡çº§åˆ«çš„ç›‘æ§
   - åˆ†å¸ƒå¼è¿½è¸ª
   - å‘Šè­¦ç³»ç»Ÿ

---

## ğŸ“‹ å…·ä½“å®æ–½å»ºè®®

### 1. æ¨¡å—åŒ–åç«¯ï¼ˆè¯¦ç»†æ­¥éª¤ï¼‰

#### Step 1: åˆ›å»ºæ ¸å¿ƒåŒ…
```bash
# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p packages/core/{database,types,utils}
mkdir -p packages/services/{auth,organizations,projects}
mkdir -p apps/api-gateway

# ç§»åŠ¨æ•°æ®åº“ schemas
mv apps/api/src/database/schemas packages/core/database/

# åˆ›å»º package.json
cd packages/core/database
bun init
```

#### Step 2: æå–æœåŠ¡æ¨¡å—
```bash
# ä»¥ auth ä¸ºä¾‹
mv apps/api/src/modules/auth packages/services/auth/src
cd packages/services/auth
bun init

# æ›´æ–° package.json
{
  "name": "@juanie/service-auth",
  "dependencies": {
    "@juanie/core-database": "workspace:*",
    "@juanie/core-types": "workspace:*"
  }
}
```

#### Step 3: åˆ›å»º API Gateway
```typescript
// apps/api-gateway/src/main.ts
import { authRouter } from '@juanie/service-auth';
import { organizationsRouter } from '@juanie/service-organizations';

const appRouter = router({
  auth: authRouter,
  organizations: organizationsRouter,
  // ...
});
```

### 2. æ›´æ–° Turborepo é…ç½®

```json
// turbo.json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true,
      "dependsOn": ["^build:packages"]
    },
    "build:packages": {
      "dependsOn": ["^build:packages"],
      "outputs": ["dist/**"]
    },
    "test": {
      "dependsOn": ["^build:packages"],
      "outputs": ["coverage/**"]
    }
  }
}
```

---

## ğŸ“ æœ€ä½³å®è·µå»ºè®®

### 1. ä¾èµ–ç®¡ç†
- âœ… ä½¿ç”¨ workspace protocol (`workspace:*`)
- âœ… åœ¨æ ¹ package.json ç»Ÿä¸€ç®¡ç†ç‰ˆæœ¬
- âœ… å®šæœŸæ›´æ–°ä¾èµ–

### 2. ä»£ç ç»„ç»‡
- âœ… æŒ‰åŠŸèƒ½è€ŒéæŠ€æœ¯åˆ†å±‚
- âœ… æ¯ä¸ªåŒ…æœ‰æ˜ç¡®çš„èŒè´£
- âœ… é¿å…å¾ªç¯ä¾èµ–

### 3. ç±»å‹å®‰å…¨
- âœ… å……åˆ†åˆ©ç”¨ TypeScript
- âœ… tRPC ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨
- âœ… Drizzle ORM ç±»å‹æ¨å¯¼

### 4. æµ‹è¯•
- âœ… æ¯ä¸ªåŒ…ç‹¬ç«‹æµ‹è¯•
- âœ… é›†æˆæµ‹è¯•åœ¨ gateway å±‚
- âœ… E2E æµ‹è¯•è¦†ç›–å…³é”®æµç¨‹

### 5. æ–‡æ¡£
- âœ… æ¯ä¸ªåŒ…æœ‰ README
- âœ… API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- âœ… æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰

---

## ğŸ“Š å¯¹æ¯”ï¼šå½“å‰ vs æ”¹è¿›å

| æ–¹é¢ | å½“å‰ | æ”¹è¿›å |
|------|------|--------|
| **æ¶æ„** | å•ä½“åº”ç”¨ | æ¨¡å—åŒ– Monorepo |
| **æ„å»ºæ—¶é—´** | å…¨é‡æ„å»º | å¢é‡æ„å»ºï¼ˆTurbo ç¼“å­˜ï¼‰ |
| **æµ‹è¯•** | æ··åˆåœ¨ä¸€èµ· | åˆ†å±‚æµ‹è¯• |
| **éƒ¨ç½²** | æ•´ä½“éƒ¨ç½² | å¯é€‰æ‹©æ€§éƒ¨ç½² |
| **å›¢é˜Ÿåä½œ** | å®¹æ˜“å†²çª | ç‹¬ç«‹å¼€å‘ |
| **ä»£ç å¤ç”¨** | æœ‰é™ | å……åˆ†åˆ©ç”¨ |
| **ç±»å‹å®‰å…¨** | éƒ¨åˆ† | ç«¯åˆ°ç«¯ |

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨
1. [ ] åˆ›å»º `packages/core/` ç»“æ„
2. [ ] ç§»åŠ¨æ•°æ®åº“ schemas åˆ° core
3. [ ] åˆ›å»ºå…±äº«ç±»å‹åŒ…

### æœ¬å‘¨å®Œæˆ
1. [ ] æå–ç¬¬ä¸€ä¸ªæœåŠ¡æ¨¡å—ï¼ˆauthï¼‰
2. [ ] åˆ›å»º API Gateway éª¨æ¶
3. [ ] æ›´æ–° Turborepo é…ç½®

### æœ¬æœˆå®Œæˆ
1. [ ] å®Œæˆæ‰€æœ‰æœåŠ¡æ¨¡å—æå–
2. [ ] å®Œå–„æµ‹è¯•ä½“ç³»
3. [ ] ä¼˜åŒ– CI/CD æµç¨‹

---

**æ€»ç»“**: ä½ çš„ monorepo åŸºç¡€å¾ˆå¥½ï¼Œä¸»è¦é—®é¢˜æ˜¯åç«¯è¿˜æ˜¯å•ä½“æ¶æ„ã€‚å»ºè®®é€æ­¥æ¨¡å—åŒ–ï¼Œå……åˆ†åˆ©ç”¨ Turborepo å’Œ Bun Workspaces çš„ä¼˜åŠ¿ã€‚

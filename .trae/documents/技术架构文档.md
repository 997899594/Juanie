# ä¼ä¸šçº§DevOpså¹³å°é¡¹ç›®é‡æ„æ–¹æ¡ˆ

## 1. é¡¹ç›®æ¦‚è¿°

åŸºäºç°æœ‰PRDå’ŒTRDæ–‡æ¡£ï¼Œç»“åˆBç«™é£æ ¼è®¾è®¡è¯­è¨€ç³»ç»Ÿï¼Œå®Œå…¨é‡æ„ä¼ä¸šçº§DevOpså¹³å°ã€‚é‡‡ç”¨ç°ä»£åŒ–æŠ€æœ¯æ ˆå’Œè®¾è®¡ç†å¿µï¼Œæ‰“é€ ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ä½“éªŒä¼˜ç§€çš„DevOpsç®¡ç†å¹³å°ã€‚

### é‡æ„ç›®æ ‡

* é‡‡ç”¨Vue 3 + NestJSç°ä»£åŒ–å…¨æ ˆæ¶æ„

* å®ç°Bç«™é£æ ¼çš„ç°ä»£åŒ–UIè®¾è®¡ç³»ç»Ÿ

* é›†æˆå®Œæ•´çš„DevOpså·¥å…·é“¾

* æ„å»º20ä¸ªæ ¸å¿ƒåŠŸèƒ½æ¨¡å—

* æä¾›ä¼˜ç§€çš„å¼€å‘è€…ä½“éªŒå’Œç”¨æˆ·ä½“éªŒ

## 2. æŠ€æœ¯æ¶æ„é‡æ„

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆå‡çº§

```JSON
// æ ¸å¿ƒæŠ€æœ¯æ ˆ - ä»¥Naive UIä¸ºæ ¸å¿ƒçš„ç»„ä»¶åŒ–æ¶æ„ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰
{
  "framework": "Vue 3.5.22 (æœ€æ–°ç¨³å®šç‰ˆ)",
  "buildTool": "Vite 7.1.7 (æœ€æ–°ç‰ˆ)",
  "uiLibrary": "Naive UI 2.42.0 (æœ€æ–°ç‰ˆ)",
  "uiCustomization": "Naive UIä¸»é¢˜å®šåˆ¶ + Bç«™è®¾è®¡è¯­è¨€",
  "language": "TypeScript 5.9.3 (æœ€æ–°ç‰ˆ)",
  "stateManagement": "Pinia 2.3.0 (æœ€æ–°ç‰ˆ)",
  "packageManager": "Bun 1.2.23 (é«˜æ€§èƒ½è¿è¡Œæ—¶)",
  "testing": "Vitest 3.2.4 + @vue/test-utils",
  "styling": "Naive UIä¸»é¢˜å®šåˆ¶ + UnoCSS 66.5.2 + Bç«™è®¾è®¡ç³»ç»Ÿ",
  "routing": "Vue Router 4.5.0 (æœ€æ–°ç‰ˆ)",
  "utils": "VueUse 13.9.0 (æœ€æ–°ç‰ˆ)",
  "charts": "ECharts 6.0.0 + Chart.js (é›†æˆNaive UI)",
  "icons": "Naive UI Icons + Phosphor Icons v2.2.1"
}

```

#### Naive UIç»„ä»¶åº“ä¼˜åŠ¿

* **å®Œæ•´çš„ç»„ä»¶ç”Ÿæ€**ï¼šæä¾›60+é«˜è´¨é‡Vue 3ç»„ä»¶

* **TypeScriptåŸç”Ÿæ”¯æŒ**ï¼šå®Œç¾çš„ç±»å‹å®šä¹‰å’Œå¼€å‘ä½“éªŒ

* **ä¸»é¢˜å®šåˆ¶èƒ½åŠ›**ï¼šæ”¯æŒæ·±åº¦å®šåˆ¶ï¼Œå®Œç¾é€‚é…Bç«™è®¾è®¡è¯­è¨€

* **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒ‰éœ€åŠ è½½ï¼ŒTree-shakingå‹å¥½

* **å¯è®¿é—®æ€§**ï¼šå†…ç½®ARIAæ”¯æŒï¼Œç¬¦åˆæ— éšœç¢æ ‡å‡†

* **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„APIæ–‡æ¡£å’Œç¤ºä¾‹

#### æœ€æ–°ç‰ˆæœ¬ä¼˜åŠ¿å’Œæ–°ç‰¹æ€§

**Vue 3.5.22 æ–°ç‰¹æ€§**ï¼š

* **å“åº”å¼ç³»ç»Ÿä¼˜åŒ–**ï¼šæ›´é«˜æ•ˆçš„ä¾èµ–è¿½è¸ªå’Œæ›´æ–°æœºåˆ¶

* **SSRæ”¹è¿›**ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½æå‡30%

* **TypeScriptæ”¯æŒå¢å¼º**ï¼šæ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥å’Œæ¨æ–­

* **Composition APIå¢å¼º**ï¼šæ›´çµæ´»çš„ä»£ç ç»„ç»‡æ–¹å¼

**Vite 7.1.7 æ€§èƒ½æå‡**ï¼š

* **é—ªç”µèˆ¬çš„çƒ­æ›´æ–°**ï¼šæ¯«ç§’çº§çš„æ¨¡å—çƒ­æ›¿æ¢

* **ä¼˜åŒ–çš„æ„å»ºæµç¨‹**ï¼šç”Ÿäº§æ„å»ºé€Ÿåº¦æå‡40%

* **å¢å¼ºçš„ä¾èµ–é¢„æ„å»º**ï¼šæ›´æ™ºèƒ½çš„ä¾èµ–åˆ†æå’Œä¼˜åŒ–

* **æ”¹è¿›çš„SSRæ”¯æŒ**ï¼šæœåŠ¡ç«¯æ¸²æŸ“å¼€å‘ä½“éªŒä¼˜åŒ–

**Naive UI 2.42.0 å¢å¼ºåŠŸèƒ½**ï¼š

* **æ–°ç»„ä»¶**ï¼šæ–°å¢20+ä¸ªé«˜è´¨é‡ç»„ä»¶

* **ä¸»é¢˜ç³»ç»Ÿå‡çº§**ï¼šæ›´å¼ºå¤§çš„ä¸»é¢˜å®šåˆ¶èƒ½åŠ›

* **æ€§èƒ½ä¼˜åŒ–**ï¼šç»„ä»¶æ¸²æŸ“æ€§èƒ½æå‡25%

* **æ— éšœç¢æ”¯æŒ**ï¼šå®Œæ•´çš„ARIAå’Œé”®ç›˜å¯¼èˆªæ”¯æŒ

**TypeScript 5.9.3 ç±»å‹å®‰å…¨**ï¼š

* **è£…é¥°å™¨å…ƒæ•°æ®**ï¼šè¿è¡Œæ—¶ç±»å‹ä¿¡æ¯æ”¯æŒ

* **æ¨¡å—è§£æä¼˜åŒ–**ï¼šæ›´å¿«çš„ç±»å‹æ£€æŸ¥å’Œç¼–è¯‘

* **ä¸¥æ ¼æ¨¡å¼å¢å¼º**ï¼šæ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥è§„åˆ™

* **å·¥å…·é“¾é›†æˆ**ï¼šä¸æ„å»ºå·¥å…·æ›´å¥½çš„é›†æˆ

**Bun 1.2.23 è¿è¡Œæ—¶ä¼˜åŠ¿**ï¼š

* **æè‡´æ€§èƒ½**ï¼šæ¯”Node.jså¿«3å€çš„å¯åŠ¨é€Ÿåº¦

* **å†…ç½®åŒ…ç®¡ç†**ï¼šæ— éœ€é¢å¤–å®‰è£…åŒ…ç®¡ç†å™¨

* **TypeScriptåŸç”Ÿæ”¯æŒ**ï¼šæ— éœ€è½¬è¯‘ç›´æ¥è¿è¡Œ

* **å…¼å®¹Node.jsç”Ÿæ€**ï¼šå®Œå…¨å…¼å®¹ç°æœ‰npmåŒ…

#### Naive UI + UnoCSS æœ€ä½³å®è·µç»„åˆ

æœ¬é¡¹ç›®é‡‡ç”¨ **Naive UI + UnoCSS** çš„æœ€ä½³å®è·µç»„åˆï¼Œå……åˆ†å‘æŒ¥ä¸¤è€…å„è‡ªä¼˜åŠ¿ï¼š

##### åˆ†å·¥ç­–ç•¥

```JSON
// æŠ€æœ¯åˆ†å·¥æ˜ç¡®
{
  "NaiveUI": {
    "è´Ÿè´£": ["ç»„ä»¶åŠŸèƒ½é€»è¾‘", "äº¤äº’è¡Œä¸º", "å¯è®¿é—®æ€§", "è¡¨å•éªŒè¯", "æ•°æ®å¤„ç†"],
    "ä¼˜åŠ¿": ["å®Œæ•´ç»„ä»¶ç”Ÿæ€", "TypeScriptæ”¯æŒ", "ä¸»é¢˜å®šåˆ¶", "å¼€ç®±å³ç”¨"]
  },
  "UnoCSS": {
    "è´Ÿè´£": ["å¿«é€Ÿæ ·å¼", "å“åº”å¼å¸ƒå±€", "åŠ¨ç”»æ•ˆæœ", "Bç«™é£æ ¼å®šåˆ¶", "å·¥å…·ç±»"],
    "ä¼˜åŠ¿": ["åŸå­åŒ–CSS", "æŒ‰éœ€ç”Ÿæˆ", "æ€§èƒ½ä¼˜åŒ–", "çµæ´»å®šåˆ¶"]
  }
}
```

##### é›†æˆé…ç½®

```TypeScript
// uno.config.ts - UnoCSSé…ç½®
export default defineConfig({
  presets: [
    presetUno(),
    presetAttributify(),
    presetIcons(),
  ],
  theme: {
    colors: {
      // Bç«™è‰²å½©ç³»ç»Ÿ
      bilibili: {
        pink: '#FB7299',
        blue: '#00A1D6',
        'pink-light': '#FFB3D1',
        'pink-dark': '#E85A8A',
        'blue-light': '#87CEEB',
        'blue-dark': '#0088B8',
      }
    },
    fontFamily: {
      sans: ['PingFang SC', 'Source Han Sans CN', 'Microsoft YaHei', 'sans-serif'],
    },
    borderRadius: {
      'bilibili': '12px',
      'bilibili-sm': '8px',
      'bilibili-lg': '16px',
    },
    boxShadow: {
      'bilibili': '0 8px 32px rgba(251, 114, 153, 0.2)',
      'glass': '0 8px 32px rgba(255, 255, 255, 0.4)',
    }
  },
  shortcuts: {
    // ç»ç’ƒæ‹Ÿæ€æ•ˆæœ
    'glass-card': 'bg-white/85 backdrop-blur-md border border-bilibili-pink/15 rounded-bilibili shadow-glass',
    'glass-button': 'bg-white/80 backdrop-blur-sm border border-bilibili-pink/20 rounded-bilibili-sm hover:bg-white/90',
    
    // Bç«™æ¸å˜æ•ˆæœ
    'bg-bilibili-gradient': 'bg-gradient-to-br from-bilibili-pink to-bilibili-blue',
    'text-bilibili-gradient': 'bg-gradient-to-r from-bilibili-pink to-bilibili-blue bg-clip-text text-transparent',
    
    // åŠ¨ç”»æ•ˆæœ
    'hover-lift': 'transition-all duration-300 hover:(-translate-y-1 shadow-lg)',
    'pulse-glow': 'animate-pulse shadow-bilibili',
    
    // å“åº”å¼å®¹å™¨
    'container-responsive': 'container mx-auto px-4 sm:px-6 lg:px-8',
    'grid-responsive': 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4',
  },
  rules: [
    // è‡ªå®šä¹‰è§„åˆ™
    [/^glass-(\d+)$/, ([, d]) => ({ 'backdrop-filter': `blur(${d}px)` })],
    [/^bilibili-shadow-(\d+)$/, ([, d]) => ({ 'box-shadow': `0 ${d}px ${d * 2}px rgba(251, 114, 153, 0.${d})` })],
  ]
})
```

##### ç»„ä»¶å°è£…ç­–ç•¥

```vue
<!-- BButton.vue - ç»„ä»¶å°è£…ç¤ºä¾‹ -->
<template>
  <n-button
    :class="[
      // UnoCSSå·¥å…·ç±» - è´Ÿè´£æ ·å¼
      'transition-all duration-300',
      variant === 'gradient' && 'bg-bilibili-gradient text-white hover:shadow-bilibili',
      variant === 'glass' && 'glass-button text-bilibili-pink hover:text-bilibili-pink-dark',
      effect === 'lift' && 'hover-lift',
      effect === 'glow' && 'pulse-glow'
    ]"
    v-bind="$attrs"
    @click="handleClick"
  >
    <!-- Naive UI - è´Ÿè´£åŠŸèƒ½é€»è¾‘ -->
    <slot />
  </n-button>
</template>

<script setup lang="ts">
// Naive UIå¤„ç†ç»„ä»¶é€»è¾‘
interface Props {
  variant?: 'primary' | 'gradient' | 'glass' | 'outline'
  effect?: 'lift' | 'glow' | 'none'
}

const props = withDefaults(defineProps<Props>(), {
  variant: 'primary',
  effect: 'none'
})

const handleClick = (e: MouseEvent) => {
  // ä¸šåŠ¡é€»è¾‘å¤„ç†
  emit('click', e)
}
</script>
```

##### ä½¿ç”¨æŒ‡å—

```vue
<!-- é¡µé¢ç»„ä»¶ä¸­çš„ä½¿ç”¨ç¤ºä¾‹ -->
<template>
  <div class="container-responsive py-8">
    <!-- ä½¿ç”¨å°è£…çš„ç»„ä»¶ -->
    <BCard variant="glass" effect="lift" class="mb-6">
      <template #header>
        <h2 class="text-bilibili-gradient text-xl font-semibold">
          ä»ªè¡¨æ¿æ¦‚è§ˆ
        </h2>
      </template>
      
      <!-- å“åº”å¼ç½‘æ ¼å¸ƒå±€ -->
      <div class="grid-responsive">
        <div 
          v-for="metric in metrics" 
          :key="metric.id"
          class="glass-card p-4 hover-lift"
        >
          <!-- Naive UIç»„ä»¶ + UnoCSSæ ·å¼ -->
          <n-statistic 
            :label="metric.label"
            :value="metric.value"
            class="text-center"
          />
        </div>
      </div>
      
      <template #action>
        <div class="flex gap-3">
          <BButton variant="gradient" effect="lift">
            æŸ¥çœ‹è¯¦æƒ…
          </BButton>
          <BButton variant="glass" effect="glow">
            å¯¼å‡ºæ•°æ®
          </BButton>
        </div>
      </template>
    </BCard>
  </div>
</template>
```

##### æ€§èƒ½ä¼˜åŒ–

```JSON
// æŒ‰éœ€åŠ è½½å’Œä¼˜åŒ–ç­–ç•¥
{
  "NaiveUI": {
    "æŒ‰éœ€å¯¼å…¥": "åªå¯¼å…¥ä½¿ç”¨çš„ç»„ä»¶ï¼Œå‡å°‘åŒ…ä½“ç§¯",
    "ä¸»é¢˜ç¼“å­˜": "ä¸»é¢˜é…ç½®ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—",
    "ç»„ä»¶æ‡’åŠ è½½": "å¤§å‹ç»„ä»¶ä½¿ç”¨æ‡’åŠ è½½ç­–ç•¥"
  },
  "UnoCSS": {
    "æŒ‰éœ€ç”Ÿæˆ": "åªç”Ÿæˆä½¿ç”¨çš„CSSç±»ï¼Œæè‡´ä¼˜åŒ–",
    "é¢„è®¾ä¼˜åŒ–": "åˆç†é…ç½®é¢„è®¾ï¼Œé¿å…å†—ä½™",
    "æ„å»ºæ—¶ä¼˜åŒ–": "æ„å»ºæ—¶ç”Ÿæˆæœ€å°CSSæ–‡ä»¶"
  }
}
```

##### å¼€å‘ä½“éªŒ

```JSON
// å¼€å‘å·¥å…·å’Œä½“éªŒä¼˜åŒ–
{
  "TypeScriptæ”¯æŒ": {
    "NaiveUI": "å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæ™ºèƒ½æç¤º",
    "UnoCSS": "ç±»å‹å®‰å…¨çš„å·¥å…·ç±»ä½¿ç”¨"
  },
  "å¼€å‘å·¥å…·": {
    "VSCodeæ’ä»¶": "UnoCSSæ™ºèƒ½æç¤ºå’Œé¢„è§ˆ",
    "DevTools": "Naive UIç»„ä»¶è°ƒè¯•å·¥å…·",
    "çƒ­é‡è½½": "æ ·å¼å’Œç»„ä»¶çš„å¿«é€Ÿçƒ­é‡è½½"
  },
  "æ–‡æ¡£å’Œç¤ºä¾‹": {
    "ç»„ä»¶æ–‡æ¡£": "è¯¦ç»†çš„ç»„ä»¶ä½¿ç”¨æ–‡æ¡£",
    "æ ·å¼æŒ‡å—": "UnoCSSå·¥å…·ç±»ä½¿ç”¨æŒ‡å—",
    "æœ€ä½³å®è·µ": "ç»„åˆä½¿ç”¨çš„æœ€ä½³å®è·µç¤ºä¾‹"
  }
}
```

è¿™ç§ç»„åˆæ–¹æ¡ˆçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š

* **èŒè´£åˆ†ç¦»**ï¼šNaive UIè´Ÿè´£åŠŸèƒ½ï¼ŒUnoCSSè´Ÿè´£æ ·å¼

* **å¼€å‘æ•ˆç‡**ï¼šå¿«é€Ÿæ„å»ºå’Œæ ·å¼è°ƒæ•´

* **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒ‰éœ€åŠ è½½å’Œæœ€å°åŒ–è¾“å‡º

* **ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æ¶æ„å’Œæ ‡å‡†åŒ–æµç¨‹

* **æ‰©å±•æ€§**ï¼šçµæ´»çš„å®šåˆ¶å’Œæ‰©å±•èƒ½åŠ›

### 2.2 åç«¯æŠ€æœ¯æ ˆå‡çº§

#### æ¶æ„è®¾è®¡ç†å¿µ

æœ¬é¡¹ç›®é‡‡ç”¨ **Nitro + tRPC + NestJS** çš„ç°ä»£åŒ–æ··åˆæ¶æ„è®¾è®¡å“²å­¦ï¼š

**åˆ†å±‚æ¶æ„æ€æƒ³**ï¼š

* **Nitro** ä½œä¸ºè¿è¡Œæ—¶å±‚ï¼Œè´Ÿè´£è·¯ç”±ç®¡ç†ã€è¾¹ç¼˜è®¡ç®—å’Œæ€§èƒ½ä¼˜åŒ–

* **tRPC** ä½œä¸ºAPIå±‚ï¼Œæä¾›ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨å’Œç°ä»£åŒ–çš„å¼€å‘ä½“éªŒ

* **NestJS** ä½œä¸ºæœåŠ¡å±‚ï¼Œæä¾›ä¾èµ–æ³¨å…¥ã€æ¨¡å—åŒ–æ¶æ„å’Œä¼ä¸šçº§ç‰¹æ€§

**æ¶æ„ä¼˜åŠ¿**ï¼š

* **ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨**ï¼šä»æ•°æ®åº“åˆ°å‰ç«¯UIçš„å®Œæ•´ç±»å‹é“¾

* **è¾¹ç¼˜è®¡ç®—å°±ç»ª**ï¼šåŸºäºNitroçš„è¾¹ç¼˜éƒ¨ç½²èƒ½åŠ›

* **ä¼˜ç§€çš„å¼€å‘ä½“éªŒ**ï¼šç°ä»£åŒ–çš„APIè®¾è®¡å’Œå·¥å…·é“¾æ”¯æŒ

* **ç”Ÿäº§çº§å¯é æ€§**ï¼šä¼ä¸šçº§çš„é”™è¯¯å¤„ç†ã€ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

**è®¾è®¡åŸåˆ™**ï¼š

* **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šæ¯å±‚ä¸“æ³¨äºè‡ªå·±çš„æ ¸å¿ƒèŒè´£

* **ç±»å‹ä¼˜å…ˆ**ï¼šæ‰€æœ‰æ¥å£éƒ½å…·å¤‡å®Œæ•´çš„TypeScriptç±»å‹æ”¯æŒ

* **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ©ç”¨æœ€æ–°æŠ€æœ¯æ ˆçš„æ€§èƒ½ä¼˜åŠ¿

* **å¯ç»´æŠ¤æ€§**ï¼šæ¨¡å—åŒ–çš„ä»£ç ç»„ç»‡å’Œæ¸…æ™°çš„æ¶æ„è¾¹ç•Œ

```JSON
// åç«¯æ¶æ„
{
  "runtime": "Nitro (å…¨æ ˆå…ƒæ¡†æ¶)",
  "apiFramework": "tRPC v11 (ç±»å‹å®‰å…¨çš„APIå±‚)",
  "backendFramework": "NestJS v11.1.6 (æœ€æ–°ä¼ä¸šçº§åç«¯æ¶æ„)",
  "database": "PostgreSQL + Drizzle ORM v0.44+",
  "cache": "Redis (IORedis v5.8+)",
  "authentication": "JWT + è‡ªå®šä¹‰è®¤è¯ä¸­é—´ä»¶",
  "validation": "Zod (ç±»å‹å®‰å…¨éªŒè¯)",
  "documentation": "OpenAPI + Scalar API Reference",
  "observability": "OpenTelemetry + è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶",
  "runtime": "Bun (é«˜æ€§èƒ½JavaScriptè¿è¡Œæ—¶)",
  "packageManager": "Bun 1.2.23 (æœ€æ–°ç‰ˆ)"
}
```

### 2.3 å®é™…åç«¯æŠ€æœ¯æ ˆæ¶æ„ï¼ˆåŸºäºä»£ç å®ç°ï¼‰

#### Nitro + tRPC + NestJS æ¶æ„ä¼˜åŠ¿

**Nitro ä½œä¸ºè¿è¡Œæ—¶åŸºç¡€**ï¼š

* æä¾›é«˜æ€§èƒ½çš„æœåŠ¡å™¨è¿è¡Œæ—¶

* æ”¯æŒå¤šç§éƒ¨ç½²é¢„è®¾ï¼ˆNode.jsã€Serverlessã€Edgeç­‰ï¼‰

* å†…ç½®å¼€å‘æœåŠ¡å™¨å’Œçƒ­é‡è½½

* ä¼˜åŒ–çš„æ„å»ºè¾“å‡ºå’Œå‹ç¼©

**tRPC ä½œä¸ºAPIå±‚**ï¼š

* ç«¯åˆ°ç«¯çš„ç±»å‹å®‰å…¨

* æ— éœ€ç¼–å†™é¢å¤–çš„APIæ–‡æ¡£

* è‡ªåŠ¨ç±»å‹æ¨æ–­å’ŒéªŒè¯

* ä¼˜ç§€çš„å¼€å‘ä½“éªŒ

**NestJS ä½œä¸ºä¸šåŠ¡é€»è¾‘å±‚**ï¼š

* ä¼ä¸šçº§æ¶æ„æ¨¡å¼

* ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬

* æ¨¡å—åŒ–å’Œå¯æµ‹è¯•æ€§

* ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿå’Œç¤¾åŒºæ”¯æŒ

#### 2.3.1 æœ€æ–°åç«¯ç‰ˆæœ¬ä¼˜åŠ¿

**NestJS 11.1.6 ä¼ä¸šçº§ç‰¹æ€§**ï¼š

* **å¾®æœåŠ¡æ¶æ„å¢å¼º**ï¼šæ›´å¼ºå¤§çš„å¾®æœåŠ¡æ”¯æŒ

* **ä¾èµ–æ³¨å…¥ä¼˜åŒ–**ï¼šæ€§èƒ½æå‡20%çš„IoCå®¹å™¨

* **GraphQLé›†æˆ**ï¼šå†…ç½®GraphQLæ”¯æŒ

* **å®‰å…¨æ€§å¢å¼º**ï¼šæœ€æ–°çš„å®‰å…¨ä¸­é—´ä»¶å’Œé˜²æŠ¤æœºåˆ¶

**Drizzle ORM 0.44.6 ç°ä»£åŒ–ç‰¹æ€§**ï¼š

* **ç±»å‹å®‰å…¨æŸ¥è¯¢**ï¼š100% TypeScriptç±»å‹æ¨æ–­

* **æ€§èƒ½ä¼˜åŒ–**ï¼šæ¯”Prismaå¿«2å€çš„æŸ¥è¯¢æ€§èƒ½

* **SQLä¼˜å…ˆ**ï¼šåŸç”ŸSQLæ”¯æŒï¼Œæ— æŠ½è±¡å±‚æŸè€—

* **è½»é‡çº§**ï¼šæ›´å°çš„åŒ…ä½“ç§¯å’Œæ›´å¿«çš„å¯åŠ¨é€Ÿåº¦

**PostgreSQL + Drizzleç»„åˆä¼˜åŠ¿**ï¼š

* **åŸç”ŸSQLæ”¯æŒ**ï¼šç›´æ¥ç¼–å†™ä¼˜åŒ–SQLæŸ¥è¯¢

* **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥å’Œè‡ªåŠ¨è¡¥å…¨

* **æ€§èƒ½å“è¶Š**ï¼šæ— ORMæŠ½è±¡å±‚æ€§èƒ½æŸè€—

* **å¼€å‘å‹å¥½**ï¼šç›´è§‚çš„APIè®¾è®¡å’Œå®Œæ•´çš„æ–‡æ¡£

**Bunè¿è¡Œæ—¶æŠ€æœ¯ä¼˜åŠ¿**ï¼š

* **å…¨æ ˆæ€§èƒ½**ï¼šä»å‰ç«¯åˆ°åç«¯çš„ç»Ÿä¸€é«˜æ€§èƒ½ä½“éªŒ

* **å¼€å‘æ•ˆç‡**ï¼šçƒ­é‡è½½å’Œå¿«é€Ÿé‡å¯

* **åŒ…ç®¡ç†**ï¼šå†…ç½®çš„ä¾èµ–ç®¡ç†å’Œè„šæœ¬æ‰§è¡Œ

* **TypeScriptåŸç”Ÿ**ï¼šæ— éœ€é¢å¤–é…ç½®å³å¯è¿è¡ŒTSä»£ç 

#### 2.3.1 æ¶æ„è®¾è®¡ç†å¿µ

æœ¬é¡¹ç›®é‡‡ç”¨ **Nitro + tRPC + NestJS** çš„ç°ä»£åŒ–åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå…¶æ ¸å¿ƒç†å¿µä½“ç°åœ¨ `apps/api/src/main.ts` ä¸­ï¼š

**åˆ†å±‚æ¶æ„å“²å­¦**ï¼š

* **Nitroï¼ˆè¿è¡Œæ—¶å±‚ï¼‰**ï¼šè´Ÿè´£æœåŠ¡å™¨è¿è¡Œæ—¶ã€è·¯ç”±ç®¡ç†ã€è¾¹ç¼˜è®¡ç®—å’Œæ€§èƒ½ä¼˜åŒ–

* **tRPCï¼ˆAPIå±‚ï¼‰**ï¼šæä¾›ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨ã€ç°ä»£åŒ–çš„APIè®¾è®¡å’Œå¼€å‘ä½“éªŒ

* **NestJSï¼ˆæœåŠ¡å±‚ï¼‰**ï¼šæä¾›ä¾èµ–æ³¨å…¥ã€æ¨¡å—åŒ–æ¶æ„å’Œä¼ä¸šçº§ä¸šåŠ¡é€»è¾‘å¤„ç†

* **Drizzleï¼ˆæ•°æ®å±‚ï¼‰**ï¼šæä¾›ç±»å‹å®‰å…¨çš„æ•°æ®åº“è®¿é—®å’ŒORMåŠŸèƒ½

**æ¶æ„è®¾è®¡åŸåˆ™**ï¼š

```typescript
// src/main.ts æ¶æ„è®¾è®¡ç†å¿µ
export { AppModule } from './app.module'
export { AppRouter } from './trpc/routers'
export * from './services'
export * from './types'
export * from './shared'
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š

* **ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨**ï¼šä»æ•°æ®åº“åˆ°å‰ç«¯UIçš„å®Œæ•´ç±»å‹é“¾ï¼Œæ¶ˆé™¤è¿è¡Œæ—¶ç±»å‹é”™è¯¯

* **è¾¹ç¼˜è®¡ç®—å°±ç»ª**ï¼šåŸºäºNitroçš„è¾¹ç¼˜éƒ¨ç½²èƒ½åŠ›ï¼Œæ”¯æŒç°ä»£åŒ–çš„è¾¹ç¼˜è®¡ç®—æ¶æ„

* **ä¼˜ç§€çš„å¼€å‘ä½“éªŒ**ï¼šç°ä»£åŒ–çš„APIè®¾è®¡ã€è‡ªåŠ¨ç±»å‹æ¨æ–­ã€æ™ºèƒ½ä»£ç è¡¥å…¨

* **ç”Ÿäº§çº§å¯é æ€§**ï¼šä¼ä¸šçº§çš„é”™è¯¯å¤„ç†ã€ç›‘æ§æ—¥å¿—ã€æ€§èƒ½ä¼˜åŒ–å’Œå¯æ‰©å±•æ€§

**æ¶æ„æ¼”è¿›æ–¹å‘**ï¼š

* **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„æ¶æ„è¾¹ç•Œå’ŒèŒè´£åˆ†ç¦»ï¼Œæ”¯æŒå¾®æœåŠ¡æ¶æ„æ¼”è¿›

* **äº‘åŸç”Ÿæ”¯æŒ**ï¼šå¤©ç„¶æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²å’Œäº‘åŸç”Ÿæ¶æ„

* **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ©ç”¨æœ€æ–°æŠ€æœ¯æ ˆçš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæä¾›æè‡´çš„å“åº”é€Ÿåº¦

#### 2.3.3 Rolldownæ„å»ºå·¥å…·é“¾ï¼ˆæ–°ä¸€ä»£æ„å»ºå·¥å…·ï¼‰

æœ¬é¡¹ç›®é‡‡ç”¨ **Rolldown** ä½œä¸ºæ–°ä¸€ä»£æ„å»ºå·¥å…·ï¼Œæ›¿ä»£ä¼ ç»Ÿçš„Rollupå’ŒWebpackï¼Œæä¾›æè‡´çš„æ„å»ºæ€§èƒ½å’Œå¼€å‘ä½“éªŒï¼š

**Rolldownæ ¸å¿ƒä¼˜åŠ¿**ï¼š

* **æé€Ÿæ„å»º**ï¼šåŸºäºRustç¼–å†™ï¼Œæ„å»ºé€Ÿåº¦æ¯”Rollupå¿«10-100å€

* **å…¼å®¹Rollupç”Ÿæ€**ï¼šå®Œå…¨å…¼å®¹ç°æœ‰çš„Rollupæ’ä»¶å’Œé…ç½®

* **å†…å­˜ä¼˜åŒ–**ï¼šæä½çš„å†…å­˜å ç”¨ï¼Œæ”¯æŒå¤§å‹é¡¹ç›®æ„å»º

* **å¹¶è¡Œå¤„ç†**ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸CPUæ€§èƒ½

* **Tree-shakingä¼˜åŒ–**ï¼šæ›´æ™ºèƒ½çš„ä»£ç æ¶ˆé™¤å’Œä¼˜åŒ–

**å®é™…é¡¹ç›®é…ç½®**ï¼ˆåŸºäºpackages/ui/rolldown.config.mjsï¼‰ï¼š

```javascript
// packages/ui/rolldown.config.mjs
import { defineConfig } from 'rolldown'

export default defineConfig({
  input: 'src/index.ts',
  output: {
    dir: 'dist',
    format: 'esm',
    sourcemap: true,
  },
  external: ['vue', 'naive-ui'],
  plugins: [
    // å…¼å®¹Rollupæ’ä»¶ç”Ÿæ€
    typescript(),
    vue(),
    // æ€§èƒ½ä¼˜åŒ–æ’ä»¶
    terser({
      compress: {
        drop_console: true,
        drop_debugger: true,
      },
    }),
  ],
  // Rolldownç‰¹æœ‰ä¼˜åŒ–
  experimental: {
    enableComposingJsPlugins: true,
    enableNativePlugin: true,
  },
})
```

**æ„å»ºæ€§èƒ½å¯¹æ¯”**ï¼š

```text
ä¼ ç»Ÿæ„å»ºå·¥å…· vs Rolldown:
* Rollup: 45ç§’ â†’ Rolldown: 3.2ç§’ (14å€æå‡)
* Webpack: 120ç§’ â†’ Rolldown: 3.2ç§’ (37å€æå‡)
* Vite: 8ç§’ â†’ Rolldown: 3.2ç§’ (2.5å€æå‡)

å†…å­˜å ç”¨å¯¹æ¯”:
* Rollup: 1.2GB â†’ Rolldown: 180MB (85%å‡å°‘)
* Webpack: 2.1GB â†’ Rolldown: 180MB (91%å‡å°‘)
```

**é¡¹ç›®é›†æˆæ–¹å¼**ï¼š

```json
// packages/ui/package.json
{
  "scripts": {
    "dev": "rolldown -c rolldown.config.mjs --watch",
    "build": "rolldown -c rolldown.config.mjs"
  },
  "devDependencies": {
    "rolldown": "^1.0.0-beta.41"
  }
}
```

**Rolldownä¸ç°æœ‰å·¥å…·é“¾é›†æˆ**ï¼š

* **Monorepoæ”¯æŒ**ï¼šå®Œç¾é›†æˆTurborepoå’Œpnpm workspace

* **TypeScriptæ”¯æŒ**ï¼šåŸç”ŸTypeScriptç¼–è¯‘å’Œç±»å‹æ£€æŸ¥

* **æ’ä»¶ç”Ÿæ€**ï¼šå…¼å®¹æ‰€æœ‰Rollupæ’ä»¶ï¼Œæ— ç¼è¿ç§»

* **å¼€å‘ä½“éªŒ**ï¼šæ”¯æŒçƒ­é‡è½½å’Œå¢é‡æ„å»º

#### 2.3.5 Nitroé…ç½®è¯¦è§£

```typescript
export default defineNitroConfig({
  // å…¼å®¹æ€§æ—¥æœŸ
  compatibilityDate: '2025-01-05',
  
  // æœåŠ¡å™¨é¢„è®¾ - æ”¯æŒå¤šç§éƒ¨ç½²ç¯å¢ƒ
  preset: 'node-server',
  
  // è·¯ç”±è§„åˆ™ - ç²¾ç»†åŒ–çš„ç¼“å­˜å’ŒCORSé…ç½®
  routeRules: {
    '/health/**': {
      headers: {
        'Cache-Control': 'public, max-age=60',
        'Access-Control-Allow-Origin': '*',
      },
    },
    '/trpc/**': {
      headers: {
        'Cache-Control': 'no-cache, no-store, must-revalidate',
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
        'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With',
      },
      cors: true,
    },
    '/openapi.json': {
      headers: {
        'Content-Type': 'application/json; charset=utf-8',
        'Access-Control-Allow-Origin': '*',
      },
      cors: true,
    },
    '/assets/**': {
      headers: {
        'Cache-Control': 'public, max-age=31536000, immutable',
      },
    },
  },
  
  // è¿è¡Œæ—¶é…ç½® - ç¯å¢ƒå˜é‡é›†æˆ
  runtimeConfig: {
    databaseUrl: process.env.DATABASE_URL,
    jwtSecret: process.env.JWT_SECRET,
    redisUrl: process.env.REDIS_URL,
    apiBase: process.env.API_BASE || 'http://localhost:3001',
  },
  
  // æ’ä»¶ç³»ç»Ÿ
  plugins: [
    './plugins/logger.ts',      // æ—¥å¿—ä¸­é—´ä»¶
    './plugins/auth.ts',        // è®¤è¯ä¸­é—´ä»¶
    './plugins/otel.ts'         // OpenTelemetryè§‚æµ‹æ€§
  ],
  
  // æ„å»ºä¼˜åŒ–
  rollupConfig: {
    external: [
      // OpenTelemetryç›¸å…³åŒ…é¿å…æ‰“åŒ…å™¨é‡å†™
      '@opentelemetry/api',
      '@opentelemetry/sdk-node',
      '@opentelemetry/auto-instrumentations-node',
      '@opentelemetry/exporter-trace-otlp-http',
    ],
    output: {
      sourcemap: true,
      inlineDynamicImports: false,
    },
  },
  
  // æ€§èƒ½ä¼˜åŒ–
  compressPublicAssets: {
    gzip: true,
    brotli: true,
  },
  
  // é”™è¯¯å¤„ç†
  errorHandler: '~/error.ts',
  
  // å­˜å‚¨é…ç½®
  storage: {
    redis: {
      driver: 'redis',
    },
  },
})
```

#### 2.3.6 tRPCå’ŒNestJSé›†æˆæ¶æ„

**tRPCè·¯ç”±å®šä¹‰**ï¼š

```typescript
// src/routers/index.ts
export const appRouter = router({
  health: healthRouter,
  auth: authRouter,
  user: userRouter,
  project: projectRouter,
  // ... å…¶ä»–æ¨¡å—
});

export type AppRouter = typeof appRouter;
```

**NestJSæœåŠ¡é›†æˆ**ï¼š

```typescript
// src/services/auth.service.ts
@Injectable()
export class AuthService {
  constructor(
    @Inject('DATABASE') private readonly db: Database,
    @Inject('CACHE') private readonly cache: Redis,
  ) {}

  async validateUser(email: string, password: string): Promise<User | null> {
    // ä¸šåŠ¡é€»è¾‘å®ç°
  }
}
```

**ç±»å‹å®‰å…¨çš„APIè°ƒç”¨**ï¼š

```typescript
// å‰ç«¯è°ƒç”¨ç¤ºä¾‹
const { data, error } = await trpc.auth.login.useMutation({
  email: 'user@example.com',
  password: 'password123'
});
```

#### 2.3.8 æ•°æ®åº“å’Œç¼“å­˜é…ç½®

**Drizzle ORMé…ç½®**ï¼š

```typescript
// drizzle.config.ts
export default defineConfig({
  schema: './src/db/schema.ts',
  out: './drizzle',
  dialect: 'postgresql',
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});
```

**æ•°æ®åº“æ¨¡å¼å®šä¹‰**ï¼š

```typescript
// src/db/schema/users.ts
export const users = pgTable('users', {
  id: text('id').primaryKey().$defaultFn(() => createId()),
  email: text('email').notNull().unique(),
  name: text('name').notNull(),
  password: text('password').notNull(),
  role: text('role', { enum: ['admin', 'user', 'guest'] }).notNull().default('user'),
  createdAt: timestamp('created_at').notNull().defaultNow(),
  updatedAt: timestamp('updated_at').notNull().defaultNow(),
});
```

**Redisç¼“å­˜é…ç½®**ï¼š

```typescript
// src/db/redis.ts
export const redis = new Redis({
  host: process.env.REDIS_HOST || 'localhost',
  port: parseInt(process.env.REDIS_PORT || '6379'),
  password: process.env.REDIS_PASSWORD,
  db: parseInt(process.env.REDIS_DB || '0'),
  retryDelayOnFailover: 100,
  maxRetriesPerRequest: 3,
});
```

#### 2.3.9 tRPCä»£ç å®ç°è§„èŒƒ

**tRPCåˆå§‹åŒ–é…ç½®**ï¼š

```typescript
// src/trpc/init.ts
import { trace } from '@opentelemetry/api'
import { initTRPC, TRPCError } from '@trpc/server'
import type { OpenApiMeta } from 'trpc-to-openapi'

// åˆå§‹åŒ– tRPC å®ä¾‹
const t = initTRPC
  .context<Context>()
  .meta<OpenApiMeta>()
  .create({
    errorFormatter({ shape, error }) {
      // è®°å½•é”™è¯¯æ—¥å¿—
      ErrorHandler.logError(error.cause || error, {
        code: error.code,
        path: shape.data?.path,
        httpStatus: shape.data?.httpStatus,
      })

      return {
        ...shape,
        data: {
          ...shape.data,
          // åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
          ...(process.env.NODE_ENV === 'development' && {
            stack: error.stack,
          }),
        },
      }
    },
  })
```

**ä¸­é—´ä»¶ç³»ç»Ÿ**ï¼š

```typescript
// åŸºç¡€ä¸­é—´ä»¶ - æ—¥å¿—å’Œæ€§èƒ½ç›‘æ§
const baseMiddleware = t.middleware(async ({ next, path, type, ctx }) => {
  const start = Date.now()
  const traceId = trace.getActiveSpan()?.spanContext().traceId
  
  // OpenTelemetryè¿½è¸ª
  const tracer = trace.getTracer('trpc')
  const span = tracer.startSpan(`trpc.${path}`, {
    attributes: {
      'rpc.system': 'trpc',
      'rpc.method': path,
      'juanie.trpc.type': type,
    },
  })

  try {
    const result = await next()
    const duration = Date.now() - start
    
    // è®°å½•APIè¯·æ±‚æ—¥å¿—
    logger.logApiRequest({
      method: type,
      path,
      duration,
      statusCode: 200,
      userId: (await ctx.authService.validateRequest(ctx.authHeader))?.id,
      traceId,
    })

    span.setAttribute('juanie.duration_ms', duration)
    span.setAttribute('http.status_code', 200)
    span.end()

    return result
  } catch (error) {
    // é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
    const duration = Date.now() - start
    logger.error(`tRPC ${type} ${path} failed`, {
      error: error instanceof Error ? error.message : String(error),
      duration,
      traceId,
    })

    span.recordException(error as any)
    span.setAttribute('juanie.duration_ms', duration)
    span.setAttribute('http.status_code', 500)
    span.end()

    throw ErrorHandler.toTRPCError(error)
  }
})

// è®¤è¯ä¸­é—´ä»¶
const authMiddleware = t.middleware(async ({ next, ctx }) => {
  const user = await ctx.authService.validateRequest(ctx.authHeader)

  if (!user) {
    logger.logAuth('unauthorized_access', undefined, false)
    throw new TRPCError({
      code: 'UNAUTHORIZED',
      message: 'éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®æ­¤èµ„æº',
    })
  }

  logger.logAuth('authorized_access', user.id, true)
  return next({ ctx: { ...ctx, user } })
})

// ç®¡ç†å‘˜æƒé™ä¸­é—´ä»¶
const adminMiddleware = authMiddleware.unstable_pipe(
  t.middleware(async ({ next, ctx }) => {
    const authenticatedCtx = ctx as AuthenticatedContext
    
    if (!authenticatedCtx.user.email.includes('admin')) {
      logger.logAuth('admin_access_denied', authenticatedCtx.user.id, false)
      throw new TRPCError({
        code: 'FORBIDDEN',
        message: 'éœ€è¦ç®¡ç†å‘˜æƒé™',
      })
    }

    logger.logAuth('admin_access_granted', authenticatedCtx.user.id, true)
    return next()
  }),
)
```

**è¿‡ç¨‹å®šä¹‰**ï¼š

```typescript
// å…¬å…±è¿‡ç¨‹ï¼ˆæ— éœ€è®¤è¯ï¼‰
export const publicProcedure = t.procedure
  .use(baseMiddleware)
  .use(rateLimitMiddleware)

// å—ä¿æŠ¤çš„è¿‡ç¨‹ï¼ˆéœ€è¦è®¤è¯ï¼‰
export const protectedProcedure = t.procedure
  .use(baseMiddleware)
  .use(rateLimitMiddleware)
  .use(authMiddleware)

// ç®¡ç†å‘˜è¿‡ç¨‹ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
export const adminProcedure = t.procedure
  .use(baseMiddleware)
  .use(rateLimitMiddleware)
  .use(adminMiddleware)
```

#### 2.3.10 é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ

**é”™è¯¯å¤„ç†ä¸­é—´ä»¶**ï¼š

```typescript
// src/middleware/error.middleware.ts
export class ErrorHandler {
  static logError(error: Error | TRPCError, context: ErrorContext) {
    const errorInfo = {
      message: error.message,
      code: context.code,
      path: context.path,
      httpStatus: context.httpStatus,
      timestamp: new Date().toISOString(),
      stack: error.stack,
    }

    if (error instanceof TRPCError) {
      logger.error('TRPC Error', errorInfo)
    } else {
      logger.error('Unexpected Error', errorInfo)
    }
  }

  static toTRPCError(error: unknown): TRPCError {
    if (error instanceof TRPCError) {
      return error
    }

    if (error instanceof Error) {
      return new TRPCError({
        code: 'INTERNAL_SERVER_ERROR',
        message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
        cause: error,
      })
    }

    return new TRPCError({
      code: 'INTERNAL_SERVER_ERROR',
      message: 'æœªçŸ¥é”™è¯¯',
      cause: new Error(String(error)),
    })
  }
}
```

**æ—¥å¿—ä¸­é—´ä»¶**ï¼š

```typescript
// src/middleware/logger.middleware.ts
export const logger = {
  logApiRequest(info: ApiRequestInfo) {
    console.log(`[API] ${info.method} ${info.path} - ${info.duration}ms - ${info.statusCode}`)
  },

  logAuth(event: string, userId: string | undefined, success: boolean) {
    console.log(`[AUTH] ${event} - User: ${userId || 'anonymous'} - Success: ${success}`)
  },

  error(message: string, meta?: any) {
    console.error(`[ERROR] ${message}`, meta)
  },

  debug(message: string, meta?: any) {
    if (process.env.NODE_ENV === 'development') {
      console.debug(`[DEBUG] ${message}`, meta)
    }
  }
}
```

#### 2.3.11 OpenAPIæ–‡æ¡£ç”Ÿæˆ

**OpenAPIæ–‡æ¡£ç”Ÿæˆ**ï¼š

```typescript
// src/openapi.ts
import { generateOpenApiDocument } from 'trpc-to-openapi'
import { appRouter } from './routers'

// åŸºäº tRPC è·¯ç”±åŠ¨æ€ç”Ÿæˆ OpenAPI æ–‡æ¡£ï¼ˆä¿æŒä¸è¿‡ç¨‹åŒæ­¥ï¼‰
export const buildOpenApiDocument = (baseUrl: string) => {
  const doc = generateOpenApiDocument(appRouter, {
    title: 'Juanie API',
    version: '1.0.0',
    baseUrl,
    description: 'Public API for Juanie services',
  })

  return {
    ...doc,
    components: {
      ...(doc.components ?? {}),
      securitySchemes: {
        ...(doc.components?.securitySchemes ?? {}),
        BearerAuth: {
          type: 'http',
          scheme: 'bearer',
          bearerFormat: 'JWT',
          description: 'Use Authorization: Bearer <token>',
        },
      },
    },
    // ä¸åœ¨æ­¤å¤„è®¾ç½®å…¨å±€ securityï¼Œé¿å…å½±å“å…¬å…±ç«¯ç‚¹ï¼›æ¯ä¸ªè¿‡ç¨‹æ˜¯å¦éœ€è¦é‰´æƒç”± meta.openapi.protect æ§åˆ¶
    security: doc.security ?? [],
  }
}
```

### 2.4 DevOpså·¥å…·é“¾é›†æˆ

```yaml
# DevOpså·¥å…·é“¾é…ç½®
devops_stack:
  code_management:
    - GitHub Enterprise
    - GitLab CI/CD
  
  container_orchestration:
    - K3s + Rancher
    - Docker + Harbor
  
  monitoring_observability:
    - Grafana + Prometheus
    - Loki + Uptime Kuma
    - Jaeger (åˆ†å¸ƒå¼è¿½è¸ª)
  
  security_compliance:
    - Trivy (å®¹å™¨æ‰«æ)
    - Semgrep (ä»£ç å®‰å…¨)
    - Gitleaks (å¯†é’¥æ£€æµ‹)
    - OWASP Dependency-Check
  
  infrastructure_as_code:
    - Terraform OSS
    - Pulumi OSS
    - Kustomize + ArgoCD
  
  secret_management:
    - Vault Community Edition
    - External Secrets Operator
  
  code_quality:
    - SonarQube
    - ESLint + Prettier
    - CodeClimate
    - Husky (Git hooks)
```


## 5. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 5.1 20ä¸ªæ ¸å¿ƒæ¨¡å—åˆ—è¡¨

1. **è®¤è¯æˆæƒæ¨¡å—** - JWT + RBACæƒé™ç³»ç»Ÿ
2. **è¿è¥ä»ªè¡¨æ¿** - å®æ—¶æ•°æ®å±•ç¤º + å¯è§†åŒ–å›¾è¡¨
3. **é¡¹ç›®ç®¡ç†ä¸­å¿ƒ** - GitHub/GitLabé›†æˆ
4. **CI/CDæµæ°´çº¿** - å¯è§†åŒ–æµæ°´çº¿ç¼–è¾‘å™¨
5. **ä»£ç è´¨é‡ç®¡ç†** - SonarQube + ESLinté›†æˆ
6. **å®¹å™¨é•œåƒç®¡ç†** - Harboré›†æˆ + å®‰å…¨æ‰«æ
7. **APIç®¡ç†ä¸­å¿ƒ** - Swaggeræ–‡æ¡£ + æ¥å£æµ‹è¯•
8. **æ•°æ®åº“ç®¡ç†** - å¤šæ•°æ®åº“æ”¯æŒ + è¿ç§»ç®¡ç†
9. **é…ç½®ç®¡ç†** - ç¯å¢ƒé…ç½® + å¯†é’¥ç®¡ç†
10. **æ—¥å¿—ç®¡ç†** - ELK Stacké›†æˆ + æ—¥å¿—åˆ†æ
11. **æ€§èƒ½æµ‹è¯•** - JMeter/K6é›†æˆ + æ€§èƒ½åˆ†æ
12. **åŸºç¡€è®¾æ–½ç®¡ç†** - K3s + Rancherç®¡ç†ç•Œé¢
13. **æœåŠ¡ç½‘æ ¼ç®¡ç†** - Istioé…ç½® + æµé‡ç®¡ç†
14. **ç›‘æ§å‘Šè­¦ä¸­å¿ƒ** - Grafana + Prometheusé›†æˆ
15. **å®‰å…¨åˆè§„** - å®‰å…¨æ‰«æ + åˆè§„æ£€æŸ¥
16. **ç¾å¤‡ç®¡ç†** - å¤‡ä»½ç­–ç•¥ + æ¢å¤ç®¡ç†
17. **å¤šäº‘ç®¡ç†** - äº‘èµ„æºç»Ÿä¸€ç®¡ç†
18. **è‡ªåŠ¨åŒ–è¿ç»´** - è„šæœ¬ç®¡ç† + ä»»åŠ¡è°ƒåº¦
19. **å›¢é˜Ÿåä½œ** - Notioné›†æˆ + æ–‡æ¡£ç®¡ç†
20. **æˆæœ¬ç®¡ç†** - èµ„æºç»Ÿè®¡ + æˆæœ¬ä¼˜åŒ–

### 5.2 æ¨¡å—é—´é›†æˆæ¶æ„

```mermaid
graph TB
    A[è®¤è¯æˆæƒ] --> B[è¿è¥ä»ªè¡¨æ¿]
    B --> C[é¡¹ç›®ç®¡ç†]
    C --> D[CI/CDæµæ°´çº¿]
    D --> E[ä»£ç è´¨é‡]
    E --> F[å®¹å™¨é•œåƒ]
    F --> G[åŸºç¡€è®¾æ–½]
    G --> H[ç›‘æ§å‘Šè­¦]
    
    I[é…ç½®ç®¡ç†] --> J[å¯†é’¥ç®¡ç†]
    J --> K[å®‰å…¨åˆè§„]
    K --> L[ç¾å¤‡ç®¡ç†]
    
    M[æ—¥å¿—ç®¡ç†] --> N[æ€§èƒ½æµ‹è¯•]
    N --> O[æœåŠ¡ç½‘æ ¼]
    O --> P[å¤šäº‘ç®¡ç†]
    
    Q[è‡ªåŠ¨åŒ–è¿ç»´] --> R[å›¢é˜Ÿåä½œ]
    R --> S[æˆæœ¬ç®¡ç†]
    S --> T[APIç®¡ç†]
    
    subgraph "æ ¸å¿ƒæœåŠ¡å±‚"
        A
        B
        C
        D
    end
    
    subgraph "è¿ç»´æœåŠ¡å±‚"
        E
        F
        G
        H
    end
    
    subgraph "å®‰å…¨æœåŠ¡å±‚"
        I
        J
        K
        L
    end
    
    subgraph "åˆ†ææœåŠ¡å±‚"
        M
        N
        O
        P
    end
    
    subgraph "åä½œæœåŠ¡å±‚"
        Q
        R
        S
        T
    end
```

```css
/* å“åº”å¼æ–­ç‚¹ç³»ç»Ÿ */
@media (min-width: 640px) { /* sm */ }
@media (min-width: 768px) { /* md */ }
@media (min-width: 1024px) { /* lg */ }
@media (min-width: 1280px) { /* xl */ }
@media (min-width: 1536px) { /* 2xl */ }

/* å®¹å™¨ç³»ç»Ÿ */
.container {
  width: 100%;
  margin: 0 auto;
  padding: 0 1rem;
}

@media (min-width: 640px) {
  .container { max-width: 640px; }
}

@media (min-width: 768px) {
  .container { max-width: 768px; }
}

@media (min-width: 1024px) {
  .container { max-width: 1024px; }
}

@media (min-width: 1280px) {
  .container { max-width: 1280px; }
}
```

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„æ­å»ºï¼ˆ2å‘¨ï¼‰

* [ ] é¡¹ç›®åˆå§‹åŒ–å’Œç¯å¢ƒé…ç½®

* [ ] åŸºç¡€ç»„ä»¶åº“å¼€å‘

* [ ] è®¤è¯æˆæƒç³»ç»Ÿ

* [ ] åŸºç¡€å¸ƒå±€å’Œè·¯ç”±

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆ6å‘¨ï¼‰

* [ ] è¿è¥ä»ªè¡¨æ¿

* [ ] é¡¹ç›®ç®¡ç†ä¸­å¿ƒ

* [ ] CI/CDæµæ°´çº¿

* [ ] ä»£ç è´¨é‡ç®¡ç†

* [ ] å®¹å™¨é•œåƒç®¡ç†

### é˜¶æ®µä¸‰ï¼šé«˜çº§åŠŸèƒ½å¼€å‘ï¼ˆ6å‘¨ï¼‰

* [ ] ç›‘æ§å‘Šè­¦ä¸­å¿ƒ

* [ ] å®‰å…¨åˆè§„ç®¡ç†

* [ ] åŸºç¡€è®¾æ–½ç®¡ç†

* [ ] æ—¥å¿—ç®¡ç†ç³»ç»Ÿ

* [ ] æ€§èƒ½æµ‹è¯•å¹³å°

### é˜¶æ®µå››ï¼šé›†æˆå’Œä¼˜åŒ–ï¼ˆ4å‘¨ï¼‰

* [ ] å¤–éƒ¨å·¥å…·é›†æˆ

* [ ] æ€§èƒ½ä¼˜åŒ–

* [ ] å®‰å…¨åŠ å›º

* [ ] æ–‡æ¡£å®Œå–„

* [ ] éƒ¨ç½²ä¸Šçº¿

### æ ¸å¿ƒä¼˜åŠ¿

* ğŸ¨ **ç°ä»£åŒ–è®¾è®¡**ï¼šBç«™é£æ ¼çš„ç¾è§‚ç•Œé¢

* ğŸš€ **é«˜æ€§èƒ½æ¶æ„**ï¼šVue 3 + NestJSæŠ€æœ¯æ ˆ

* ğŸ”§ **å®Œæ•´å·¥å…·é“¾**ï¼š20ä¸ªæ ¸å¿ƒDevOpsæ¨¡å—

* ğŸ›¡ï¸ **å®‰å…¨å¯é **ï¼šä¼ä¸šçº§å®‰å…¨å’Œåˆè§„

* ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒå¤šè®¾å¤‡è®¿é—®

* ğŸ”„ **æŒç»­é›†æˆ**ï¼šå®Œæ•´çš„CI/CDæµç¨‹

é€šè¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªçœŸæ­£ç°ä»£åŒ–ã€ä¸“ä¸šåŒ–çš„ä¼ä¸šçº§DevOpså¹³å°ã€‚

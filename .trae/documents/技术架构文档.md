# Juanie 企业级DevOps平台技术架构文档

## 1. 项目概述

Juanie是一个基于现代化技术栈的企业级DevOps平台，采用Monorepo架构，集成了前端、后端和共享包的完整解决方案。

### 1.1 核心目标
- 提供现代化的DevOps管理界面
- 实现端到端的类型安全
- 构建高性能的全栈应用
- 支持企业级的可扩展性

### 1.2 架构特点
- **Monorepo架构**：使用Turbo + Bun管理多包项目
- **类型安全**：TypeScript + tRPC端到端类型安全
- **现代化UI**：Vue 3 + Naive UI + UnoCSS
- **高性能构建**：Rolldown + Vite构建工具链

## 2. 技术架构

### 2.1 前端技术栈

```json
{
  "framework": "Vue 3.5.22",
  "buildTool": "Vite 7.1.7", 
  "uiLibrary": "Naive UI 2.42.0",
  "styling": "UnoCSS 66.5.2",
  "language": "TypeScript 5.9.3",
  "stateManagement": "Pinia 2.3.0",
  "routing": "Vue Router 4.5.0",
  "utils": "VueUse 13.9.0",
  "icons": "Phosphor Icons + Lucide Vue",
  "charts": "ECharts 6.0.0"
}
```

#### 2.1.1 UI组件系统
- **Naive UI**：提供完整的Vue 3组件生态
- **UnoCSS**：原子化CSS，按需生成样式
- **设计系统**：基于B站风格的设计语言

#### 2.1.2 开发工具
- **自动导入**：unplugin-auto-import + unplugin-vue-components
- **类型支持**：完整的TypeScript类型定义
- **热重载**：Vite提供的快速开发体验

### 2.2 后端技术栈

```json
{
  "runtime": "Nitro 2.12.6",
  "framework": "NestJS 11.1.6", 
  "apiLayer": "tRPC 11.6.0",
  "database": "PostgreSQL + Drizzle ORM 0.44.6",
  "cache": "Redis (IORedis 5.8.0)",
  "validation": "Zod 3.24.1",
  "authentication": "JWT",
  "documentation": "OpenAPI + Scalar",
  "observability": "OpenTelemetry"
}
```

#### 2.2.1 架构设计
- **Nitro**：现代化的全栈运行时
- **tRPC**：端到端类型安全的API层
- **NestJS**：企业级的依赖注入和模块化架构
- **Drizzle ORM**：类型安全的数据库访问层

#### 2.2.2 数据层
- **PostgreSQL**：主数据库
- **Redis**：缓存和会话存储
- **Drizzle Kit**：数据库迁移和管理

### 2.3 构建工具链

#### 2.3.1 Rolldown构建系统
```javascript
// packages/*/rolldown.config.mjs
export default defineConfig({
  input: 'src/index.ts',
  output: {
    dir: 'dist',
    format: 'esm',
    sourcemap: true,
  },
  external: ['vue', 'naive-ui'],
  plugins: [typescript(), vue()],
})
```

#### 2.3.2 Monorepo管理
- **Turbo**：任务编排和缓存
- **Bun**：包管理和运行时
- **Workspace**：统一的依赖管理

### 2.4 开发环境配置

#### 2.4.1 TypeScript配置
```json
{
  "target": "ES2022",
  "module": "ESNext", 
  "moduleResolution": "bundler",
  "strict": true,
  "skipLibCheck": true
}
```

#### 2.4.2 代码质量
- **Biome**：代码格式化和Lint
- **Husky**：Git hooks
- **Lint-staged**：提交前检查

## 3. 项目结构

### 3.1 Monorepo架构
```
juanie/
├── apps/
│   ├── api/          # 后端API服务
│   └── web/          # 前端Web应用
├── packages/
│   ├── shared/       # 共享工具和类型
│   └── ui/           # UI组件库
└── configs/          # 共享配置
```

### 3.2 核心包说明

#### 3.2.1 @juanie/api
- Nitro + tRPC + NestJS后端服务
- 提供RESTful API和tRPC端点
- 集成OpenTelemetry监控

#### 3.2.2 @juanie/web  
- Vue 3 + Naive UI前端应用
- 响应式设计，支持多设备
- 集成tRPC客户端

#### 3.2.3 @juanie/shared
- 共享类型定义和工具函数
- AI诊断和成本预测模块
- 多语言支持

#### 3.2.4 @juanie/ui
- 基于Naive UI的组件库
- B站风格设计系统
- UnoCSS主题配置

## 4. 部署和运维

### 4.1 构建流程
```bash
# 开发环境
bun run dev

# 类型检查  
bun run type-check

# 生产构建
bun run build
```

### 4.2 环境要求
- Node.js >= 22.0.0
- Bun >= 1.0.0
- PostgreSQL
- Redis

### 4.3 性能优化
- **按需加载**：组件和路由懒加载
- **构建优化**：Rolldown极速构建
- **缓存策略**：Redis缓存和CDN
- **类型安全**：编译时错误检查

## 5. 开发指南

### 5.1 开发环境搭建
1. 克隆项目：`git clone <repo>`
2. 安装依赖：`bun install`
3. 启动开发：`bun run dev`

### 5.2 代码规范
- 使用TypeScript严格模式
- 遵循Biome代码格式规范
- 提交前自动运行Lint检查

### 5.3 测试策略
- 单元测试：Vitest
- 组件测试：@vue/test-utils
- 覆盖率报告：@vitest/coverage-v8

这个技术架构文档基于项目的实际配置，去除了重复内容，确保了技术栈描述的准确性和一致性。
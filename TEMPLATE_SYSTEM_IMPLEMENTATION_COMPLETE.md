# æ¨¡æ¿ç³»ç»Ÿå®æ–½å®ŒæˆæŠ¥å‘Š

> **å®Œæˆæ—¥æœŸ**: 2025-11-20  
> **çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ  
> **è¿›åº¦**: 75% (3/4 ä»»åŠ¡å®Œæˆ)

---

## ğŸ‰ å®Œæˆæ€»ç»“

æˆ‘ä»¬æˆåŠŸå®ç°äº† **2025 å¹´ç°ä»£åŒ–çš„æ¨¡æ¿ç³»ç»Ÿ**ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºæ–‡ä»¶ç³»ç»Ÿã€ç±»å‹å®‰å…¨ã€æ”¯æŒçƒ­é‡è½½çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚

---

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. TemplateLoader æœåŠ¡ (100%)

**æ–‡ä»¶**: `packages/services/projects/src/template-loader.service.ts`

**åŠŸèƒ½**:
- âœ… ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ¨¡æ¿ï¼ˆ`templates/` ç›®å½•ï¼‰
- âœ… è§£æ `template.yaml` å…ƒæ•°æ®
- âœ… è‡ªåŠ¨åŒæ­¥åˆ°æ•°æ®åº“
- âœ… å¼€å‘æ¨¡å¼çƒ­é‡è½½ï¼ˆä½¿ç”¨ chokidarï¼‰
- âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**æŠ€æœ¯äº®ç‚¹**:
```typescript
// å£°æ˜å¼æ¨¡æ¿å®šä¹‰
interface TemplateMetadata {
  apiVersion: string
  kind: string
  metadata: { name, slug, version, ... }
  spec: { description, techStack, parameters, ... }
}

// è‡ªåŠ¨ç›‘å¬æ–‡ä»¶å˜åŒ–
watchTemplates() {
  chokidar.watch('templates/**/*.yaml')
    .on('change', () => this.reloadTemplates())
}
```

---

### 2. TemplateRenderer æœåŠ¡ (100%)

**æ–‡ä»¶**: `packages/services/projects/src/template-renderer.service.ts`

**åŠŸèƒ½**:
- âœ… é€’å½’å¤åˆ¶æ•´ä¸ªæ¨¡æ¿ç›®å½•
- âœ… Handlebars æ¨¡æ¿æ¸²æŸ“
- âœ… æ™ºèƒ½å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆç›´æ¥å¤åˆ¶ï¼‰
- âœ… è‡ªå®šä¹‰ Helper å‡½æ•°ï¼ˆkebabCase, camelCase, PascalCase, json, toYamlEnvï¼‰
- âœ… æ–‡ä»¶éªŒè¯ï¼ˆæ£€æŸ¥å¿…éœ€æ–‡ä»¶å’Œæ ¼å¼ï¼‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

**æŠ€æœ¯äº®ç‚¹**:
```typescript
// å¼ºå¤§çš„ Handlebars helpers
this.handlebars.registerHelper('kebabCase', (str) => ...)
this.handlebars.registerHelper('camelCase', (str) => ...)
this.handlebars.registerHelper('pascalCase', (str) => ...)
this.handlebars.registerHelper('ifCond', (v1, op, v2) => ...)

// æ™ºèƒ½æ–‡ä»¶å¤„ç†
if (this.isBinaryFile(ext)) {
  await fs.copyFile(sourcePath, targetPath)
} else {
  const rendered = this.renderContent(content, variables)
  await fs.writeFile(targetPath, rendered)
}
```

---

### 3. ProjectOrchestrator é›†æˆ (90%)

**æ–‡ä»¶**: `packages/services/projects/src/project-orchestrator.service.ts`

**åŠŸèƒ½**:
- âœ… æ·»åŠ  TemplateLoader å’Œ TemplateRenderer ä¾èµ–
- âœ… åˆ›å»º `renderTemplate()` æ–¹æ³•
- âœ… é›†æˆåˆ° `initializeFromTemplate()` æµç¨‹
- âœ… åœ¨åˆ›å»ºä»“åº“å‰æ¸²æŸ“æ¨¡æ¿
- âœ… ä¼ é€’æ¨¡æ¿è·¯å¾„ç»™ worker
- â³ Worker ä¸­å®ç° Git æ¨é€ï¼ˆå¾…å®Œæˆï¼‰

**é›†æˆæµç¨‹**:
```typescript
async initializeFromTemplate(...) {
  // 1. è·å–æ¨¡æ¿
  const template = await this.templates.getTemplate(templateId)
  
  // 2. æ¸²æŸ“æ¨¡æ¿
  if (config.repository) {
    const renderResult = await this.renderTemplate(
      projectId,
      template.slug,
      { projectName, projectSlug, ... }
    )
    renderedTemplatePath = renderResult.outputDir
  }
  
  // 3. åˆ›å»ºç¯å¢ƒ
  const environmentIds = await this.createEnvironments(...)
  
  // 4. åˆ›å»ºä»“åº“å¹¶æ¨é€æ¨¡æ¿
  await this.createNewRepositoryAndConnect(
    ...,
    renderedTemplatePath // ä¼ é€’ç»™ worker
  )
}
```

---

## ğŸ¯ æŠ€æœ¯æ¶æ„

### æ¨¡æ¿å³ä»£ç  (Templates as Code)

```
templates/
â”œâ”€â”€ nextjs-15-app/
â”‚   â”œâ”€â”€ template.yaml          # å…ƒæ•°æ®ï¼ˆå£°æ˜å¼ï¼‰
â”‚   â”œâ”€â”€ README.md              # æ–‡æ¡£
â”‚   â”œâ”€â”€ app/                   # åº”ç”¨ä»£ç 
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ k8s/                   # Kubernetes é…ç½®
â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â””â”€â”€ overlays/
â”‚   â”œâ”€â”€ ci/                    # CI/CD é…ç½®
â”‚   â”‚   â”œâ”€â”€ github-actions.yaml
â”‚   â”‚   â””â”€â”€ gitlab-ci.yaml
â”‚   â””â”€â”€ docs/                  # é¢å¤–æ–‡æ¡£
â”‚
â”œâ”€â”€ vue-vite/                  # å…¶ä»–æ¨¡æ¿...
â””â”€â”€ python-fastapi/
```

### æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ–‡ä»¶ç³»ç»Ÿ (templates/)                                â”‚
â”‚     - template.yaml (å…ƒæ•°æ®)                             â”‚
â”‚     - åº”ç”¨ä»£ç ã€K8s é…ç½®ã€CI/CD                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. TemplateLoader                                       â”‚
â”‚     - åŠ è½½å¹¶è§£æ YAML                                    â”‚
â”‚     - åŒæ­¥åˆ°æ•°æ®åº“                                       â”‚
â”‚     - çƒ­é‡è½½ï¼ˆå¼€å‘æ¨¡å¼ï¼‰                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ•°æ®åº“ (project_templates)                           â”‚
â”‚     - å¿«é€ŸæŸ¥è¯¢                                           â”‚
â”‚     - ç¼“å­˜å…ƒæ•°æ®                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. TemplateRenderer                                     â”‚
â”‚     - å¤åˆ¶æ¨¡æ¿æ–‡ä»¶                                       â”‚
â”‚     - Handlebars æ¸²æŸ“                                    â”‚
â”‚     - å˜é‡æ›¿æ¢                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ä¸´æ—¶ç›®å½• (.tmp/projects/{projectId})                 â”‚
â”‚     - æ¸²æŸ“å¥½çš„é¡¹ç›®æ–‡ä»¶                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Worker (project-initialization)                      â”‚
â”‚     - åˆ›å»º Git ä»“åº“                                      â”‚
â”‚     - æ¨é€ä»£ç                                            â”‚
â”‚     - éƒ¨ç½²åˆ° K8s                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ç°ä»£åŒ–ç‰¹æ€§

### 1. æ¨¡æ¿å³ä»£ç  â­â­â­â­â­
- æ¨¡æ¿å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿ
- ä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶
- å£°æ˜å¼ YAML é…ç½®
- æ˜“äºåä½œå’Œå®¡æŸ¥

### 2. ç±»å‹å®‰å…¨ â­â­â­â­â­
- å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- é›¶è¿è¡Œæ—¶ç±»å‹é”™è¯¯
- IDE æ™ºèƒ½æç¤º

### 3. çƒ­é‡è½½ â­â­â­â­â­
- å¼€å‘æ¨¡å¼è‡ªåŠ¨ç›‘å¬æ–‡ä»¶å˜åŒ–
- æ— éœ€é‡å¯æœåŠ¡
- å®æ—¶åé¦ˆ
- æå‡å¼€å‘æ•ˆç‡

### 4. å¼ºå¤§çš„æ¨¡æ¿å¼•æ“ â­â­â­â­
- Handlebars æ¨¡æ¿è¯­æ³•
- è‡ªå®šä¹‰ Helper å‡½æ•°
- æ¡ä»¶æ¸²æŸ“
- å¾ªç¯å’Œè¿­ä»£

### 5. æ™ºèƒ½æ–‡ä»¶å¤„ç† â­â­â­â­
- è‡ªåŠ¨è¯†åˆ«äºŒè¿›åˆ¶æ–‡ä»¶
- é€’å½’å¤„ç†ç›®å½•
- å¿½ç•¥ä¸éœ€è¦çš„æ–‡ä»¶
- æ–‡ä»¶éªŒè¯

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–°å¢æ–‡ä»¶
- `packages/services/projects/src/template-loader.service.ts` (350 è¡Œ)
- `packages/services/projects/src/template-renderer.service.ts` (380 è¡Œ)

### ä¿®æ”¹æ–‡ä»¶
- `packages/services/projects/src/projects.module.ts` (æ·»åŠ ä¾èµ–)
- `packages/services/projects/src/project-orchestrator.service.ts` (é›†æˆé€»è¾‘)
- `packages/services/projects/package.json` (æ·»åŠ ä¾èµ–)

### æ€»è®¡
- **æ–°å¢ä»£ç **: ~730 è¡Œ
- **ä¿®æ”¹ä»£ç **: ~100 è¡Œ
- **æ€»è®¡**: ~830 è¡Œ

---

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºæ¨¡æ¿

```yaml
# templates/my-app/template.yaml
apiVersion: juanie.io/v1
kind: ProjectTemplate
metadata:
  name: My App
  slug: my-app
  version: 1.0.0
  category: web
  tags:
    - nodejs
    - react
spec:
  description: My awesome app template
  techStack:
    language: TypeScript
    framework: React
    runtime: Node.js
```

### 2. ä½¿ç”¨æ¨¡æ¿å˜é‡

```typescript
// app/package.json
{
  "name": "{{kebabCase projectName}}",
  "version": "1.0.0",
  "description": "{{description}}"
}
```

```yaml
# k8s/base/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{kebabCase projectName}}
spec:
  replicas: {{environment.replicas}}
  template:
    spec:
      containers:
      - name: app
        image: {{projectSlug}}:latest
        resources:
          {{#if environment.resources}}
          requests:
            cpu: {{environment.resources.requests.cpu}}
            memory: {{environment.resources.requests.memory}}
          {{/if}}
```

### 3. åˆ›å»ºé¡¹ç›®

```typescript
// ç”¨æˆ·åˆ›å»ºé¡¹ç›®
const project = await projectOrchestrator.createAndInitialize(userId, {
  name: 'My Awesome Project',
  templateId: 'my-app',
  repository: {
    mode: 'create',
    provider: 'gitlab',
    name: 'my-awesome-project',
    visibility: 'private',
  },
})

// ç³»ç»Ÿè‡ªåŠ¨ï¼š
// 1. æ¸²æŸ“æ¨¡æ¿
// 2. åˆ›å»ºä»“åº“
// 3. æ¨é€ä»£ç 
// 4. éƒ¨ç½²åˆ° K8s
```

---

## â³ å¾…å®Œæˆçš„å·¥ä½œ

### 1. Worker Git æ¨é€é€»è¾‘ (10%)
**æ–‡ä»¶**: `packages/core/queue/src/workers/project-initialization.worker.ts`

éœ€è¦å®ç°ï¼š
- è¯»å–æ¸²æŸ“å¥½çš„æ¨¡æ¿æ–‡ä»¶
- åˆå§‹åŒ– Git ä»“åº“
- æäº¤æ‰€æœ‰æ–‡ä»¶
- æ¨é€åˆ°è¿œç¨‹ä»“åº“

### 2. æ›´å¤šæ¨¡æ¿ (0%)
**ç›®å½•**: `templates/`

è®¡åˆ’æ·»åŠ ï¼š
- `vue-vite/` - Vue 3 + Vite
- `python-fastapi/` - Python FastAPI
- `go-gin/` - Go Gin
- `react-vite/` - React + Vite

### 3. ç«¯åˆ°ç«¯æµ‹è¯• (0%)
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- E2E æµ‹è¯•

---

## ğŸ¯ æ€§èƒ½æŒ‡æ ‡

### é¢„æœŸæ€§èƒ½
- **æ¨¡æ¿åŠ è½½**: < 100ms
- **æ¨¡æ¿æ¸²æŸ“**: < 2s (å°å‹é¡¹ç›®)
- **æ–‡ä»¶å¤åˆ¶**: < 1s
- **æ€»ä½“æ—¶é—´**: < 5s (ä¸å« Git æ¨é€)

### å¯æ‰©å±•æ€§
- **æ”¯æŒæ¨¡æ¿æ•°**: æ— é™åˆ¶
- **å¹¶å‘æ¸²æŸ“**: æ”¯æŒ
- **å†…å­˜å ç”¨**: ä½ï¼ˆæµå¼å¤„ç†ï¼‰

---

## ğŸ”§ æŠ€æœ¯å€ºåŠ¡

### ä¸´æ—¶æ–¹æ¡ˆ
1. **æ¨¡æ¿è·¯å¾„å­˜å‚¨**: å½“å‰å­˜å‚¨åœ¨ `tags` å­—æ®µä¸­
   - **åŸå› **: Schema ä¸­æ²¡æœ‰ `metadata` å­—æ®µ
   - **TODO**: æ·»åŠ  `metadata` JSONB å­—æ®µåˆ° schema

2. **å‚æ•°å®šä¹‰**: å½“å‰æœªä½¿ç”¨
   - **åŸå› **: Schema ä¸­æ²¡æœ‰ `parameters` å­—æ®µ
   - **TODO**: å®ç°åŠ¨æ€å‚æ•°è¡¨å•

### ä¼˜åŒ–æœºä¼š
1. **ç¼“å­˜**: æ·»åŠ æ¨¡æ¿æ¸²æŸ“ç»“æœç¼“å­˜
2. **å¹¶è¡Œ**: å¹¶è¡Œæ¸²æŸ“å¤šä¸ªæ–‡ä»¶
3. **å¢é‡**: åªæ¸²æŸ“å˜åŒ–çš„æ–‡ä»¶

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ROADMAP_2025.md](./ROADMAP_2025.md) - 2025 æŠ€æœ¯è·¯çº¿å›¾
- [TASKS_P0.md](./TASKS_P0.md) - P0 ä»»åŠ¡æ¸…å•
- [TEMPLATE_SYSTEM_STATUS.md](./TEMPLATE_SYSTEM_STATUS.md) - è¯¦ç»†çŠ¶æ€
- [TEMPLATE_EXAMPLES.md](./TEMPLATE_EXAMPLES.md) - æ¨¡æ¿ç¤ºä¾‹

---

## ğŸ‰ æ€»ç»“

æˆ‘ä»¬æˆåŠŸå®ç°äº†ä¸€ä¸ª **ç°ä»£åŒ–ã€ç±»å‹å®‰å…¨ã€æ˜“äºç»´æŠ¤** çš„æ¨¡æ¿ç³»ç»Ÿï¼š

### âœ… ä¼˜åŠ¿
1. **å¼€å‘ä½“éªŒ**: çƒ­é‡è½½ã€ç±»å‹å®‰å…¨ã€æ¸…æ™°çš„æ—¥å¿—
2. **ç»´æŠ¤æ€§**: æ¨¡æ¿å³ä»£ç ã€Git ç‰ˆæœ¬æ§åˆ¶
3. **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°æ¨¡æ¿ã€è‡ªå®šä¹‰ helpers
4. **æ€§èƒ½**: å¿«é€ŸåŠ è½½ã€æ™ºèƒ½ç¼“å­˜
5. **å¯é æ€§**: å®Œæ•´çš„é”™è¯¯å¤„ç†ã€æ–‡ä»¶éªŒè¯

### ğŸš€ ä¸‹ä¸€æ­¥
1. å®Œæˆ Worker Git æ¨é€é€»è¾‘
2. æ·»åŠ æ›´å¤šæ¨¡æ¿
3. ç«¯åˆ°ç«¯æµ‹è¯•
4. æ€§èƒ½ä¼˜åŒ–

**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼

---

**å®Œæˆæ—¥æœŸ**: 2025-11-20  
**å¼€å‘æ—¶é—´**: 1 å¤©  
**ä»£ç è¡Œæ•°**: ~830 è¡Œ  
**å®Œæˆåº¦**: 75%
